<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.plcopen.org/xml/tc6_0200">
  <fileHeader companyName="WAGO" productName="e!COCKPIT" productVersion="e!COCKPIT" creationDateTime="2020-04-19T09:49:04.2817699" />
  <contentHeader name="HomeAutomation.ecp" modificationDateTime="2020-04-19T09:44:10.9645242">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1" />
      </fbd>
      <ld>
        <scaling x="1" y="1" />
      </ld>
      <sfc>
        <scaling x="1" y="1" />
      </sfc>
    </coordinateInfo>
    <addData>
      <data name="http://www.3s-software.com/plcopenxml/projectinformation" handleUnknown="implementation">
        <ProjectInformation />
      </data>
    </addData>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="COVER_STATES">
        <baseType>
          <enum>
            <values>
              <value name="Idle" />
              <value name="Auto" />
              <value name="Manual" />
              <value name="Prio_up" />
              <value name="Prio_dn" />
              <value name="Calibrate_up" />
              <value name="Calibrate_dn" />
            </values>
          </enum>
        </baseType>
        <addData />
      </dataType>
      <dataType name="MQTT_MESSAGE">
        <baseType>
          <struct>
            <variable name="Payload">
              <type>
                <string length="128" />
              </type>
            </variable>
            <variable name="Topic">
              <type>
                <string length="128" />
              </type>
            </variable>
            <variable name="Qos">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="MqttRetain">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
        <addData />
      </dataType>
      <dataType name="RS485_RtuQuery">
        <baseType>
          <struct>
            <variable name="DeviceId">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="FunctionCode">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="ReadAddress">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="ReadQuantity">
              <type>
                <UINT />
              </type>
            </variable>
          </struct>
        </baseType>
        <addData />
      </dataType>
      <dataType name="VIRTUAL_MODES">
        <baseType>
          <enum>
            <values>
              <value name="Input" />
              <value name="Output" />
            </values>
          </enum>
        </baseType>
        <addData />
      </dataType>
    </dataTypes>
    <pous>
      <pou name="_RMP_B" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="DIR">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> true = up </xhtml>
              </documentation>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="RMP">
              <type>
                <BYTE />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tl">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tn">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dir">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="start">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">(* read system timer *)
tx := DWORD_TO_TIME(OSCAT_BASIC.T_PLC_MS());

IF E AND init AND (dir = last_dir) AND (RMP &lt;&gt; SEL(DIR, 0, 255)) AND TR = tn THEN
	RMP := OSCAT_BASIC.FRMP_B(start, DIR, tx - tl, TR);
ELSE
	init := TRUE;
	tl := tx;
	tn := tr;
	start := RMP;
END_IF;
last_dir := dir;



(* revison history
hm	22. oct. 2008	rev 1.0
	original version

hm	20. nov. 2008	rev 1.1
	set default for E to be TRUE
	added init

hm	19. nov. 2011	rev 1.2
	new code
*)</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetRMP">
              <interface>
                <inputVars>
                  <variable name="RMP">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">(*THIS^.RMP:=RMP;*)
THIS^.Start:=RMP;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="BLIND_ACTUATOR" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="S_IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="T_UD">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10s0ms" />
              </initialValue>
            </variable>
            <variable name="T_ANGLE">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#3s0ms" />
              </initialValue>
            </variable>
            <variable name="T_LOCKOUT">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#100ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="POS">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="ANG">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="QU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="QD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="position">
              <type>
                <derived name="RMP_B" />
              </type>
            </variable>
            <variable name="angle">
              <type>
                <derived name="RMP_B" />
              </type>
            </variable>
            <variable name="lock">
              <type>
                <derived name="OSCAT_BASIC.INTERLOCK" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">(* make sure only one motor is active at a given time *)
lock(i1 := UP, I2 := DN, TL := T_lockout);

(* ramp up or down to simulate the angle position of the blind slats *)
angle(e := lock.Q1 OR lock.Q2, UP := lock.Q1, PT := T_Angle);
position(e := lock.Q1 AND angle.high OR lock.Q2 AND angle.low, up := lock.Q1, PT := T_UD);

(* set the outputs *)
pos := position.Out;
ang := angle.Out;

(* set the outputs *)
QU := lock.Q1;
QD := lock.Q2;

(* set the status output *)
IF UP AND DN THEN
	 status := 1;			(* error up and down together are not allowed *)
ELSIF UP THEN
	status := 121;
ELSIF DN THEN
	status := 122;
ELSE
	status := S_IN;
END_IF;


(* revision history
hm	29. sep 2007	rev 1.0
	original release

hm	6. oct 2007	rev 1.1
	rearanged outputs

hm	18. oct. 2008	rev 1.2
	changed calls for rmp_B because of change in RMP_B

hm	27. jul. 2009	rev 1.3
	changes status to be 12X

ae	08. mar. 2010 rev 1.4	
	at aPosition

*)</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetPOS">
              <interface>
                <inputVars>
                  <variable name="POS">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.POS:=POS;
THIS^.position.SetRMP(POS);</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="CALC_COVER_STATE" pouType="function">
        <interface>
          <returnType>
            <derived name="COVER_STATES" />
          </returnType>
          <inputVars>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_LOCK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PI">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="MqttRequestAuto">
              <type>
                <pointer>
                  <baseType>
                    <BOOL />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttRequestStop">
              <type>
                <pointer>
                  <baseType>
                    <BOOL />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttRequestCalibrateUp">
              <type>
                <pointer>
                  <baseType>
                    <BOOL />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttRequestCalibrateDn">
              <type>
                <pointer>
                  <baseType>
                    <BOOL />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="CurrentState">
              <type>
                <derived name="COVER_STATES" />
              </type>
            </variable>
            <variable name="StateTimer">
              <type>
                <pointer>
                  <baseType>
                    <derived name="TOF" />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="NewState">
              <type>
                <derived name="COVER_STATES" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF PRIO_LOCK THEN
	NewState := COVER_STATES.Idle;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF PRIO_UP THEN
	NewState := COVER_STATES.Prio_up;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF PRIO_DN THEN
	NewState := COVER_STATES.Prio_dn;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF UP OR DN THEN
	NewState := COVER_STATES.Manual;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF MqttRequestStop^ THEN
	NewState := COVER_STATES.Idle;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF MqttRequestAuto^ AND PI &lt;&gt; POS THEN
	NewState := COVER_STATES.Auto;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF MqttRequestAuto^ AND PI = POS THEN
	NewState := COVER_STATES.Idle;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF MqttRequestCalibrateUp^ THEN
	NewState := COVER_STATES.Calibrate_up;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSIF MqttRequestCalibrateDn^ THEN
	NewState := COVER_STATES.Calibrate_dn;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
ELSE
	NewState := COVER_STATES.Idle;
	MqttRequestAuto^ := FALSE;
	MqttRequestStop^ := FALSE;
	MqttRequestCalibrateUp^ := FALSE;
	MqttRequestCalibrateDn^ := FALSE;
END_IF

IF NewState &lt;&gt; CurrentState THEN
	//Reset StateTimer
	StateTimer^.IN:=TRUE;
END_IF

CALC_COVER_STATE := NewState;</xhtml>
          </ST>
        </body>
        <addData />
      </pou>
      <pou name="FB_INPUT_BINARYSENSOR_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="BS">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Follows the input but debounced </xhtml>
              </documentation>
            </variable>
            <variable name="EVENT">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Event outputs only high for on clock cycle </xhtml>
              </documentation>
            </variable>
            <variable name="EVENT_R">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="EVENT_F">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="FB_DEBOUNCE">
              <type>
                <derived name="OSCAT_BUILDING.DEBOUNCE" />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> to debounce the physical input </xhtml>
              </documentation>
            </variable>
            <variable name="FB_R_TRIG">
              <type>
                <derived name="Standard.R_TRIG" />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> to detect a rising edge on the debounced signal </xhtml>
              </documentation>
            </variable>
            <variable name="FB_F_TRIG">
              <type>
                <derived name="Standard.F_TRIG" />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> to detect a falling edge on the debounced signal </xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DEBOUNCE(IN := BS,	
	TD := T#50MS, (* 2x cyle + 10ms *)
	PM := FALSE,
	Q=&gt;Q);

FB_R_TRIG(CLK := FB_DEBOUNCE.Q);
FB_F_TRIG(CLK := FB_DEBOUNCE.Q);

EVENT := FB_R_TRIG.Q OR FB_F_TRIG.Q;
EVENT_R := FB_R_TRIG.Q;
EVENT_F := FB_F_TRIG.Q;

IF FB_R_TRIG.Q AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'ON',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF

IF FB_F_TRIG.Q AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'OFF',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_INPUT_PUSHBUTTON_DIMMER_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PB">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="DIM">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="DBL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SINGLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DOUBLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="LONG">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P_LONG">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="FB_DIMMER">
              <type>
                <derived name="OSCAT_BUILDING.DIMM_I" />
              </type>
            </variable>
            <variable name="OutputDimmer">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Qos_Dimm">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="Delta_Dimm">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="FB_DETECTPUSH">
              <type>
                <derived name="OSCAT_BUILDING.CLICK_MODE" />
              </type>
            </variable>
            <variable name="P_LONG_R_TRIG">
              <type>
                <derived name="Standard.R_TRIG" />
              </type>
            </variable>
            <variable name="P_LONG_F_TRIG">
              <type>
                <derived name="Standard.F_TRIG" />
              </type>
            </variable>
            <variable name="PreviousDim">
              <type>
                <BYTE />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Vars to detect statechanges on outputs </xhtml>
              </documentation>
            </variable>
            <variable name="PreviousQ">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PreviousDBL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T_Debounce">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default values for dimmer, can be overwritten by method call </xhtml>
              </documentation>
            </variable>
            <variable name="T_Reconfig">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10s0ms" />
              </initialValue>
            </variable>
            <variable name="T_On_Max">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#0ms" />
              </initialValue>
            </variable>
            <variable name="T_Dimm_Start">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#400ms" />
              </initialValue>
            </variable>
            <variable name="T_Dimm">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#3s0ms" />
              </initialValue>
            </variable>
            <variable name="Min_On">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="50" />
              </initialValue>
            </variable>
            <variable name="Max_On">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
            </variable>
            <variable name="Soft_Dimm">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="Dbl_Toggle">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Rst_Out">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="T_Long">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#400ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default value for click mode, can be overwritten by method call </xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DIMMER(
	IN:= PB,
	SET:= SET,
	VAL:= VAL,
	RST:= RST,
	OUT:= DIM,
	T_DEBOUNCE:= T_Debounce,
	T_RECONFIG:= T_Reconfig,
	T_ON_MAX:= T_On_Max,
	T_DIMM_START:= T_Dimm_Start,
	T_DIMM:= T_Dimm,
	MIN_ON:= Min_On,
	MAX_ON:= Max_On,
	SOFT_DIMM:= Soft_Dimm,
	DBL_TOGGLE:= Dbl_Toggle,
	RST_OUT:= Rst_Out,
	Q=&gt; Q,
	DBL=&gt; DBL);
	
FB_DETECTPUSH(
	IN:= PB, 	
	SINGLE=&gt; SINGLE, 
	DOUBLE=&gt; DOUBLE, 
	TP_LONG=&gt; LONG, 
	T_LONG:= T_long);
	
P_LONG_R_TRIG(CLK:=FB_DETECTPUSH.LONG);
P_LONG_F_TRIG(CLK:=FB_DETECTPUSH.LONG);
	
IF (ABS(BYTE_TO_INT(PreviousDim) - BYTE_TO_INT(DIM)) &gt;= Delta_Dimm OR PB = FALSE) AND DIM &lt;&gt; PreviousDim AND InitMqttDone AND OutputDimmer THEN
	PreviousDim:=DIM;
	pMqttPublishQueue^.AddMessage(		
		Payload := BYTE_TO_STRING(DIM),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/DIM'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF FB_DIMMER.Q &lt;&gt; PreviousQ AND InitMqttDone THEN
	PreviousQ:=FB_DIMMER.Q;
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(FB_DIMMER.Q),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/Q'),
		Qos := Qos_Dimm,
		MqttRetain := TRUE
	);
END_IF

IF FB_DIMMER.DBL &lt;&gt; PreviousDBL AND InitMqttDone THEN
	PreviousDBL:=FB_DIMMER.DBL;
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(FB_DIMMER.DBL),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/DBL'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF

IF FB_DETECTPUSH.SINGLE AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'SINGLE',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF FB_DETECTPUSH.DOUBLE AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'DOUBLE',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF FB_DETECTPUSH.TP_LONG AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'LONG',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF (P_LONG_R_TRIG.Q OR P_LONG_F_TRIG.Q) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(FB_DETECTPUSH.LONG),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),'/P_LONG'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="OutputDimmer">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Qos_Dimm">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="Delta_Dimm">
                    <type>
                      <INT />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;

THIS^.OutputDimmer:=OutputDimmer;
THIS^.Qos_Dimm:=Qos_Dimm;
THIS^.Delta_Dimm:=Delta_Dimm;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlock">
              <interface>
                <inputVars>
                  <variable name="T_Debounce">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default values for dimmer, can be overwritten by method call </xhtml>
                    </documentation>
                  </variable>
                  <variable name="T_Reconfig">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_On_Max">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_Dimm_Start">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_Dimm">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="Min_On">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                  <variable name="Max_On">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                  <variable name="Soft_Dimm">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Dbl_Toggle">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Rst_Out">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="T_Long">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default value for click mode, can be overwritten by method call </xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.T_Debounce:=T_Debounce;
THIS^.T_Reconfig:=T_Reconfig;
THIS^.T_On_Max:=T_On_Max;
THIS^.T_Dimm_Start:=T_Dimm_Start;
THIS^.T_Dimm:=T_Dimm;
THIS^.Min_On:=Min_On;
THIS^.Max_On:=Max_On;

THIS^.T_Long:=T_Long;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_INPUT_PUSHBUTTON_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PB">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="SINGLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DOUBLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="LONG">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P_LONG">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="FB_DETECTPUSH">
              <type>
                <derived name="OSCAT_BUILDING.CLICK_MODE" />
              </type>
            </variable>
            <variable name="P_LONG_R_TRIG">
              <type>
                <derived name="Standard.R_TRIG" />
              </type>
            </variable>
            <variable name="P_LONG_F_TRIG">
              <type>
                <derived name="Standard.F_TRIG" />
              </type>
            </variable>
            <variable name="T_Long">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#400ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default value for click mode, can be overwritten by method call </xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DETECTPUSH(
	IN:= PB, 	
	SINGLE=&gt; SINGLE, 
	DOUBLE=&gt; DOUBLE, 
	TP_LONG=&gt; LONG, 
	LONG=&gt; P_LONG,
	T_LONG:= T_Long);
	
P_LONG_R_TRIG(CLK:=FB_DETECTPUSH.LONG);
P_LONG_F_TRIG(CLK:=FB_DETECTPUSH.LONG);
	
IF FB_DETECTPUSH.SINGLE AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'SINGLE',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF FB_DETECTPUSH.DOUBLE AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'DOUBLE',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF FB_DETECTPUSH.TP_LONG AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := 'LONG',
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := FALSE
	);
END_IF

IF (P_LONG_R_TRIG.Q OR P_LONG_F_TRIG.Q) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(FB_DETECTPUSH.LONG),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),'/P_LONG'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlock">
              <interface>
                <inputVars>
                  <variable name="T_Long">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default value for click mode, can be overwritten by method call </xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.T_Long:=T_Long;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_MqttPublishQueue" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="FULL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="localMessage">
              <type>
                <derived name="MQTT_MESSAGE" />
              </type>
            </variable>
            <variable name="fifo">
              <type>
                <array>
                  <dimension lower="0" upper="n" />
                  <baseType>
                    <derived name="MQTT_MESSAGE" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="pr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pw">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="n">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1024" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> changing this value will chage the number of stored elements in the fifo </xhtml>
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml" />
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="GetMessage">
              <interface>
                <returnType>
                  <derived name="MQTT_MESSAGE" />
                </returnType>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF NOT EMPTY THEN
	GetMessage := fifo[pr];
	pr := OSCAT_BASIC.INC1(pr,n);
	EMPTY := pr = pw;
	FULL := FALSE;
END_IF;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="AddMessage">
              <interface>
                <inputVars>
                  <variable name="Payload">
                    <type>
                      <string length="128" />
                    </type>
                  </variable>
                  <variable name="Topic">
                    <type>
                      <string length="128" />
                    </type>
                  </variable>
                  <variable name="Qos">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="MqttRetain">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF NOT FULL THEN
	localMessage.Payload := Payload;
	localMessage.Topic := Topic;
	localMessage.Qos := Qos;
	localMessage.MqttRetain := MqttRetain;
	fifo[pw] := localMessage;
	pw := OSCAT_BASIC.INC1(pw,n);
	FULL := pw = pr;
	EMPTY := FALSE;
END_IF;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Reset">
              <interface />
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">pw := pr;
FULL := FALSE;
EMPTY := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_MqttPublishWorker" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="SendDone">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="LocalMqttMessage">
              <type>
                <derived name="MQTT_MESSAGE" />
              </type>
            </variable>
            <variable name="InitDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RequestToSend">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Send">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="publish">
              <type>
                <derived name="SD_MQTT.MQTTPublish" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">//need to call publish here because of FB nums
publish(
	Topic:= ADR(LocalMqttMessage.Topic), 
	PayloadString:= ADR(LocalMqttMessage.Payload), 
	PublishAsString:= TRUE, 
	QoSIn:= LocalMqttMessage.Qos, 
	MRetain:= LocalMqttMessage.MqttRetain, 
	send:= Send);
	
IF NOT InitDone THEN RETURN; END_IF

IF RequestToSend THEN
	Send := TRUE;
	SendDone := FALSE;
END_IF

IF publish.done THEN
	 SendDone := TRUE;
	 RequestToSend:=FALSE;
	 Send:=FALSE;
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Init">
              <interface>
                <inputVars>
                  <variable name="inputMQTT_IN_OUT">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.MQTT_IN_OUT" />
                        </baseType>
                      </pointer>
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Pointer MQTTT exchange strucure</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">publish.SetMqttInOut(MQTT_IN_OUT := inputMQTT_IN_OUT);

InitDone := TRUE;
SendDone := TRUE;
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishMessage">
              <interface>
                <inputVars>
                  <variable name="MqttMessage">
                    <type>
                      <derived name="MQTT_MESSAGE" />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">LocalMqttMessage := MqttMessage;

RequestToSend:=TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_OUTPUT_COVER_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PI">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="PRIO_LOCK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SENS">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T_LOCKOUT">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T_UD">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="POS">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="MU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MD">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="FB_ACT">
              <type>
                <derived name="BLIND_ACTUATOR" />
              </type>
            </variable>
            <variable name="delta">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="internal_UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="internal_DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Qos_POS">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="Delta_POS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="Cover_State">
              <type>
                <derived name="COVER_STATES" />
              </type>
            </variable>
            <variable name="Cover_State_Timer">
              <type>
                <derived name="TOF" />
              </type>
            </variable>
            <variable name="MqttRequestAuto">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttRequestStop">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttRequestCalibrateUp">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttRequestCalibrateDn">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousPos">
              <type>
                <BYTE />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain position through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF Startup THEN
	POS:=PreviousPos;
	FB_ACT.SetPOS(PreviousPos);
END_IF

Cover_State_Timer(PT:=2 * T_UD);
Cover_State_Timer.IN:=FALSE;

CASE Cover_State OF
	COVER_STATES.Idle:
		internal_UP:=FALSE;
		internal_DN:=FALSE;
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Prio_up:
		// Only power an engine for maximum twice T_UD
		IF Cover_State_Timer.Q THEN
			internal_UP:=TRUE;
			internal_DN:=FALSE;
		ELSE
			internal_UP:=FALSE;
			internal_DN:=FALSE;
		END_IF
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Prio_dn:
		// Only power an engine for maximum twice T_UD
		IF Cover_State_Timer.Q THEN
			internal_UP:=FALSE;
			internal_DN:=TRUE;
		ELSE
			internal_UP:=FALSE;
			internal_DN:=FALSE;
		END_IF
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Auto:
		internal_UP:=TRUE;
		internal_DN:=TRUE;
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Manual:
		internal_UP:=UP;
		internal_DN:=DN;
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Calibrate_up:
		// Only power an engine for maximum twice T_UD
		IF Cover_State_Timer.Q THEN
			internal_UP:=FALSE;
			internal_DN:=TRUE;
		ELSE
			internal_UP:=FALSE;
			internal_DN:=FALSE;
			//Finish the request
			MqttRequestCalibrateUp:=FALSE;
		END_IF
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	COVER_STATES.Calibrate_dn:
		// Only power an engine for maximum twice T_UD
		IF Cover_State_Timer.Q THEN
			internal_UP:=FALSE;
			internal_DN:=TRUE;
		ELSE
			internal_UP:=FALSE;
			internal_DN:=FALSE;
			//Finish the request
			MqttRequestCalibrateDn:=FALSE;
		END_IF
		//Calculate the next state
		Cover_State := CALC_COVER_STATE(UP:=UP,DN:=DN,PRIO_LOCK:=PRIO_LOCK,PRIO_UP:=PRIO_UP,PRIO_DN:=PRIO_DN,PI:=PI,POS:=POS,MqttRequestAuto:=ADR(MqttRequestAuto),MqttRequestStop:=ADR(MqttRequestStop),MqttRequestCalibrateUp:=ADR(MqttRequestCalibrateUp),MqttRequestCalibrateDn:=ADR(MqttRequestCalibrateDn),CurrentState:=Cover_State,StateTimer:=ADR(Cover_State_Timer));
	ELSE
		Cover_State:=COVER_STATES.Idle;
END_CASE

(* Check Position*)
FB_ACT(T_UD:=T_UD, T_ANGLE:=T#0S, T_lockout := T_Lockout);

IF internal_UP AND internal_DN THEN
	(* automatic modus detected *)
	(* first find correct position *)
	IF BYTE_TO_INT(FB_ACT.pos) &lt; BYTE_TO_INT(pi) - delta THEN
		FB_ACT.UP := TRUE;
		FB_ACT.DN := FALSE;
		delta := 0;
	ELSIF BYTE_TO_INT(FB_ACT.pos) &gt; BYTE_TO_INT(pi) + delta THEN
		FB_ACT.UP := FALSE;
		FB_ACT.DN := TRUE;
		delta := 0;
	(* correct position reached *)
	ELSE
		FB_ACT.UP := FALSE;
		FB_ACT.DN := FALSE;
		delta := sens;
	END_IF;
ELSE
	FB_ACT.UP := internal_UP;
	FB_ACT.DN := internal_DN;
END_IF;

(* blind control calls blind_actuator *)
FB_ACT(T_UD:=T_UD, T_ANGLE:=T#0S, T_lockout := T_Lockout);
POS := FB_ACT.pos;
MU := FB_ACT.QU;
MD := FB_ACT.QD;

IF (ABS(BYTE_TO_INT(PreviousPos) - BYTE_TO_INT(POS)) &gt;= Delta_POS  OR (MU = FALSE AND MD = FALSE)) AND POS &lt;&gt; PreviousPos OR Startup AND InitMqttDone THEN
	PreviousPos:=POS;
	pMqttPublishQueue^.AddMessage(
		Payload := INT_TO_STRING(REAL_TO_INT(OSCAT_BASIC.SCALE_B(X:=POS, I_LO:=0, I_HI:=255, O_LO:=0, O_HI:=100))),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := Qos_POS,
		MqttRetain := TRUE
	);
	Startup:=FALSE;
END_IF
</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="Qos_POS">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="Delta_POS">
                    <type>
                      <INT />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

THIS^.Qos_POS:=Qos_POS;
THIS^.Delta_POS:=REAL_TO_INT(OSCAT_BASIC.SCALE_B(X:=INT_TO_BYTE(Delta_POS), I_LO:=0, I_HI:=100, O_LO:=0, O_HI:=255));

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized, otherwise do nothing
IF NOT(InitMqttDone) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//now process the data
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('STOP')) THEN			
		THIS^.MqttRequestStop:=TRUE;
	ELSIF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('OPEN')) THEN
		THIS^.PI:=255;
		THIS^.MqttRequestAuto:=TRUE;
	ELSIF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('CLOSE')) THEN		
		THIS^.PI:=0;
		THIS^.MqttRequestAuto:=TRUE;
	ELSIF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('CAL_UP')) THEN
		THIS^.MqttRequestCalibrateUp:=TRUE;
	ELSIF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('CAL_DN')) THEN
		THIS^.MqttRequestCalibrateDn:=TRUE;
	ELSIF OSCAT_BASIC.IS_NUM(str:= Data.PayloadString^) THEN
		THIS^.PI:=REAL_TO_BYTE(OSCAT_BASIC.SCALE_B(X:=STRING_TO_BYTE(Data.PayloadString^), I_LO:=0, I_HI:=100, O_LO:=0, O_HI:=255));
		THIS^.MqttRequestAuto:=TRUE;
	END_IF

END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlock">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="T_LOCKOUT">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_UD">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.T_LOCKOUT:=T_LOCKOUT;
THIS^.T_UD:=T_UD;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_OUTPUT_DIMMER_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SINGLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DOUBLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="LONG">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P_LONG">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PRIO_HIGH">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="PRIO_LOW">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="DBL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="t3">
              <type>
                <derived name="OSCAT_BASIC.TON" />
              </type>
            </variable>
            <variable name="dim">
              <type>
                <derived name="OSCAT_BASIC._RMP_B" />
              </type>
            </variable>
            <variable name="dir">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="OutputDimmer">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Qos_Dimm">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="Delta_Dimm">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="T_Debounce">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default values for dimmer, can be overwritten by method call </xhtml>
              </documentation>
            </variable>
            <variable name="T_Reconfig">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10s0ms" />
              </initialValue>
            </variable>
            <variable name="T_On_Max">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#0ms" />
              </initialValue>
            </variable>
            <variable name="T_Dimm_Start">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#400ms" />
              </initialValue>
            </variable>
            <variable name="T_Dimm">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#3s0ms" />
              </initialValue>
            </variable>
            <variable name="Min_On">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="50" />
              </initialValue>
            </variable>
            <variable name="Max_On">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
            </variable>
            <variable name="Soft_Dimm">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="Dbl_Toggle">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Rst_Out">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="MqttHighRequest">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttLowRequest">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousOUT">
              <type>
                <BYTE />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
            <variable name="PreviousQ">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
            <variable name="PreviousDBL">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF Startup THEN
	OUT := PreviousOUT;
	Q := PreviousQ;
	DBL := PreviousDBL;
END_IF

IF RST THEN
	IF rst_out THEN out := 0; END_IF;
	Q := FALSE;
	dir := out &gt; 127;
ELSIF PRIO_HIGH THEN
	Q := TRUE;
	OUT := 255;
ELSIF PRIO_LOW THEN
	Q := FALSE;
ELSIF MqttHighRequest THEN
	Q:= TRUE;
	MqttHighRequest := FALSE;
	MqttLowRequest := FALSE;
ELSIF MqttLowRequest THEN
	Q:= FALSE;
	MqttHighRequest := FALSE;
	MqttLowRequest := FALSE;
ELSIF set THEN
	out := val;
	Q := TRUE;
	(* set direction to up when value &lt; 127 otherwise set dir down dir is reversed because next action will reverse again *)
	dir := out &gt; 127;
ELSIF SINGLE THEN
	(* a single click reverses output Q *)
	Q := NOT Q;
	(* when dimmer is turned on we need to limit out to min and max limits *)
	IF Q THEN	out := LIMIT(MAX(MIN_ON,1), out, MAX_ON);	END_IF;
	(* set the appropriate direction of dimmer dir is reversed because next action will reverse again *)
	dir := out &gt; 127;
ELSIF LONG THEN
	IF NOT Q THEN
		IF SOFT_DIMM THEN
			OUT := 1;
			dir := TRUE;
		ELSE
			OUT := LIMIT(MAX(MIN_ON,1), out, MAX_ON);
			DIR := out &lt; 127;
		END_IF;
		Q := TRUE;
	ELSE
		(* reverse direction with every long click *)
		dir := NOT dir;
	END_IF;
END_IF;

(* set the double click output *)
IF NOT dbl_toggle THEN dbl := FALSE; END_IF;
IF DOUBLE THEN dbl := NOT dbl; END_IF;

(* while dimming is active ramp the output out up or down *)
dim(DIR := dir, e := P_LONG AND Q, TR := T_DIMM, rmp := out);

(* reverse direction when limits are reached *)
IF out = 0 THEN
	dir := TRUE;
ELSIF out = 255 THEN
	dir := FALSE;
END_IF;

(* limit the maximum runtime *)
IF t_ON_MAX &gt; t#0s THEN
	t3(in := q, pt := T_ON_MAX);
	Q := Q XOR t3.Q;
END_IF;

IF (ABS(BYTE_TO_INT(PreviousOUT) - BYTE_TO_INT(OUT)) &gt;= Delta_Dimm) OR Startup AND OUT &lt;&gt; PreviousOUT OR Startup AND InitMqttDone AND OutputDimmer THEN
	PreviousOUT:=OUT;
	pMqttPublishQueue^.AddMessage(		
		Payload := BYTE_TO_STRING(OUT),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/OUT'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF

IF Q &lt;&gt; PreviousQ OR Startup AND InitMqttDone THEN
	PreviousQ:=Q;
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(Q),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/Q'),
		Qos := Qos_Dimm,
		MqttRetain := TRUE
	);
END_IF

IF DBL &lt;&gt; PreviousDBL OR Startup AND InitMqttDone THEN
	PreviousDBL:=DBL;
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(DBL),
		Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/DBL'),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);
END_IF

Startup:=FALSE;

</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="OutputDimmer">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Qos_Dimm">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="Delta_Dimm">
                    <type>
                      <INT />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

THIS^.OutputDimmer:=OutputDimmer;
THIS^.Qos_Dimm:=Qos_Dimm;
THIS^.Delta_Dimm:=Delta_Dimm;

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlock">
              <interface>
                <inputVars>
                  <variable name="T_Debounce">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Default values for dimmer, can be overwritten by method call </xhtml>
                    </documentation>
                  </variable>
                  <variable name="T_Reconfig">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_On_Max">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_Dimm_Start">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="T_Dimm">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="Min_On">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                  <variable name="Max_On">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                  <variable name="Soft_Dimm">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Dbl_Toggle">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Rst_Out">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.T_Debounce:=T_Debounce;
THIS^.T_Reconfig:=T_Reconfig;
THIS^.T_On_Max:=T_On_Max;
THIS^.T_Dimm_Start:=T_Dimm_Start;
THIS^.T_Dimm:=T_Dimm;
THIS^.Min_On:=Min_On;
THIS^.Max_On:=Max_On;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized, otherwise do nothing
IF NOT(InitMqttDone) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//now process the data
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('TRUE')) THEN
		MqttHighRequest := TRUE;
	ELSIF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('FALSE')) THEN
		MqttLowRequest := TRUE;
	ELSIF OSCAT_BASIC.IS_CC(str:= Data.PayloadString^,cmp:='0123456789.') AND THIS^.PRIO_HIGH = FALSE THEN
		THIS^.OUT:=STRING_TO_BYTE(Data.PayloadString^);
	END_IF
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_OUTPUT_SWITCH_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PRIO_HIGH">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="PRIO_LOW">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="TOGGLE">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttHighRequest">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttLowRequest">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousState">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF Startup THEN
	OUT := PreviousState;
END_IF

IF PRIO_HIGH THEN
	OUT:=TRUE;
ELSIF(PRIO_LOW AND NOT (PRIO_HIGH)) THEN
	OUT:= FALSE;
ELSIF MqttHighRequest THEN
	OUT:= TRUE;
	MqttHighRequest := FALSE;
	MqttLowRequest := FALSE;
ELSIF MqttLowRequest THEN
	OUT:= FALSE;
	MqttHighRequest := FALSE;
	MqttLowRequest := FALSE;
ELSIF(TOGGLE) THEN
	OUT:=NOT(OUT);
END_IF;

IF(PreviousState &lt;&gt; OUT) OR Startup AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(OUT),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := SD_MQTT.QoS.ExactlyOnce,
		MqttRetain := TRUE
	);	
	Startup:=FALSE;
END_IF	

PreviousState := OUT;</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized, otherwise do nothing
IF NOT(InitMqttDone) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//now process the data
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('TRUE')) THEN
		MqttHighRequest := TRUE;
	END_IF
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('FALSE')) THEN
		MqttLowRequest := TRUE;
	END_IF
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_RS485_BUSCONTROLLER" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="BusOcupied">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Set this to True by default at startup to allow for some RS485 devices to boot up at power interuptions	</xhtml>
              </documentation>
            </variable>
          </outputVars>
          <localVars>
            <variable name="StartupDelay">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#5s0ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> Amount of time that should be waited on PLC startup to start using the RS485 bus</xhtml>
              </documentation>
            </variable>
            <variable name="SilenceTime">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#20ms" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> This is the silence time between two requests</xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Used to detect startup</xhtml>
              </documentation>
            </variable>
            <variable name="tonDelay">
              <type>
                <derived name="TON" />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To manage silence time and startup delay</xhtml>
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF Startup THEN
	tonDelay.PT := StartupDelay;
	tonDelay.IN := TRUE;
	Startup := FALSE;
END_IF


BusOcupied := NOT(tonDelay.Q);
tonDelay();</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Init">
              <interface>
                <inputVars>
                  <variable name="StartupDelay">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Amount of time that should be waited on PLC startup to start using the RS485 bus, can prevent errors due to devices not booted up yet</xhtml>
                    </documentation>
                  </variable>
                  <variable name="SilenceTime">
                    <type>
                      <TIME />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> This is the silence time between two requests</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.StartupDelay := StartupDelay;
THIS^.SilenceTime := SilenceTime;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetBusOccupied">
              <interface />
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.tonDelay.IN := FALSE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ReleaseBus">
              <interface />
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">// Start a timer to release the bus
THIS^.tonDelay.PT := THIS^.SilenceTime;
THIS^.tonDelay.IN := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_RS485_EASTRON_SDM220_MQTT" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="VOLTAGE">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="CURRENT">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="ACTIVEPOWER">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="APPARENT_POWER">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="REACTIVE_POWER">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="POWER_FACTOR">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="PHASE_ANGLE">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="DataAvailable1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Error1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="FREQUENCY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="IMPORT_ACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="EXPORT_ACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="IMPORT_REACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="EXPORT_REACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="DataAvailable2">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Error2">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="TOTAL_ACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="TOTAL_REACTIVE_ENERGY">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="DataAvailable3">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="Error3">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="InitRS485Done">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="ActiveDevice">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="ActiveRtuQuery">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="Data1RtuQuery">
              <type>
                <derived name="RS485_RtuQuery" />
              </type>
              <initialValue>
                <structValue>
                  <value member="FunctionCode">
                    <simpleValue value="4" />
                  </value>
                  <value member="ReadAddress">
                    <simpleValue value="0" />
                  </value>
                  <value member="ReadQuantity">
                    <simpleValue value="40" />
                  </value>
                </structValue>
              </initialValue>
            </variable>
            <variable name="Update1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="timerData1">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="Data2RtuQuery">
              <type>
                <derived name="RS485_RtuQuery" />
              </type>
              <initialValue>
                <structValue>
                  <value member="FunctionCode">
                    <simpleValue value="4" />
                  </value>
                  <value member="ReadAddress">
                    <simpleValue value="70" />
                  </value>
                  <value member="ReadQuantity">
                    <simpleValue value="10" />
                  </value>
                </structValue>
              </initialValue>
            </variable>
            <variable name="Update2">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="timerData2">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="Data3RtuQuery">
              <type>
                <derived name="RS485_RtuQuery" />
              </type>
              <initialValue>
                <structValue>
                  <value member="FunctionCode">
                    <simpleValue value="4" />
                  </value>
                  <value member="ReadAddress">
                    <simpleValue value="342" />
                  </value>
                  <value member="ReadQuantity">
                    <simpleValue value="4" />
                  </value>
                </structValue>
              </initialValue>
            </variable>
            <variable name="Update3">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
            <variable name="timerData3">
              <type>
                <derived name="TON" />
              </type>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>RS485Device</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">timerData1();
timerData2();
timerData3();

IF Update1 THEN
	Update1 := FALSE;
	DataAvailable1 := TRUE;
	
	IF InitMqttDone THEN
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(VOLTAGE),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/VOLT' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(CURRENT),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/CURR' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);	
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(ACTIVEPOWER),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/ACTP' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(APPARENT_POWER),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/APPP' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(REACTIVE_POWER),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/REAP' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(POWER_FACTOR),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/POWF' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(PHASE_ANGLE),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/PHAA' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
	END_IF
END_IF

IF Update2 THEN
	Update2 := FALSE;
	DataAvailable2 := TRUE;
	
	IF InitMqttDone THEN
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(FREQUENCY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/FREQ' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(IMPORT_ACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/IMAE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(EXPORT_ACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/EXAE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(IMPORT_REACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/IMRE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(EXPORT_REACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/EXRE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
	END_IF
END_IF

IF Update3 THEN
	Update3 := FALSE;	
	DataAvailable3 := TRUE;
	
	IF InitMqttDone THEN
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(TOTAL_ACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/TOTAE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
		pMqttPublishQueue^.AddMessage(
			Payload := REAL_TO_STRING(TOTAL_REACTIVE_ENERGY),
			Topic := CONCAT(CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix), '/TOTRE' ),
			Qos := SD_MQTT.QoS.ExactlyOnce,
			MqttRetain := FALSE
		);
	END_IF
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ProcessDataArray">
              <interface>
                <inputVars>
                  <variable name="Error">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="Data">
                    <type>
                      <pointer>
                        <baseType>
                          <array>
                            <dimension lower="0" upper="124" />
                            <baseType>
                              <WORD />
                            </baseType>
                          </array>
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF ActiveRtuQuery = 1 THEN
	THIS^.Error1 := Error;
	THIS^.timerData1.IN := TRUE;
	IF NOT Error THEN
		THIS^.VOLTAGE := SwapWordsToReal(Data^[0], Data^[1]);
		THIS^.CURRENT := SwapWordsToReal(Data^[6], Data^[7]);
		THIS^.ACTIVEPOWER := SwapWordsToReal(Data^[12], Data^[13]);
		THIS^.APPARENT_POWER := SwapWordsToReal(Data^[18], Data^[19]);
		THIS^.REACTIVE_POWER := SwapWordsToReal(Data^[24], Data^[25]);
		THIS^.POWER_FACTOR := SwapWordsToReal(Data^[30], Data^[31]);
		THIS^.PHASE_ANGLE := SwapWordsToReal(Data^[36], Data^[37]);
		THIS^.Update1 := TRUE;
	END_IF
ELSIF ActiveRtuQuery = 2 THEN
	THIS^.Error2:= Error;
	THIS^.timerData2.IN := TRUE;
	IF NOT Error THEN		
		THIS^.FREQUENCY := SwapWordsToReal(Data^[0], Data^[1]);
		THIS^.IMPORT_ACTIVE_ENERGY := SwapWordsToReal(Data^[2], Data^[3]);
		THIS^.EXPORT_ACTIVE_ENERGY := SwapWordsToReal(Data^[4], Data^[5]);
		THIS^.IMPORT_REACTIVE_ENERGY := SwapWordsToReal(Data^[6], Data^[7]);
		THIS^.EXPORT_REACTIVE_ENERGY := SwapWordsToReal(Data^[8], Data^[9]);
		THIS^.Update2 := TRUE;
	END_IF
ELSIF ActiveRtuQuery = 3 THEN
	THIS^.Error3 := Error;
	THIS^.timerData3.IN := TRUE;
	IF NOT Error THEN
		THIS^.TOTAL_ACTIVE_ENERGY := SwapWordsToReal(Data^[0], Data^[1]);
		THIS^.TOTAL_REACTIVE_ENERGY := SwapWordsToReal(Data^[2], Data^[3]);
		THIS^.Update3 := TRUE;
	END_IF	
END_IF

ActiveRtuQuery := 0;
ActiveDevice := FALSE;



</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitRS485">
              <interface>
                <inputVars>
                  <variable name="Data1PollingInterval">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="Data2PollingInterval">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="Data3PollingInterval">
                    <type>
                      <TIME />
                    </type>
                  </variable>
                  <variable name="DeviceAddress">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.timerData1.PT := Data1PollingInterval;
THIS^.timerData2.PT := Data2PollingInterval;
THIS^.timerData3.PT := Data3PollingInterval;

THIS^.Data1RtuQuery.DeviceId := DeviceAddress;
THIS^.Data2RtuQuery.DeviceId := DeviceAddress;
THIS^.Data3RtuQuery.DeviceId := DeviceAddress;

THIS^.timerData1.IN := TRUE;
THIS^.timerData2.IN := TRUE;
THIS^.timerData3.IN := TRUE;

THIS^.InitRS485Done := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;

THIS^.InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="RequestMaster">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="BusController">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_RS485_BUSCONTROLLER" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF NOT InitRS485Done THEN	
	RequestMaster := FALSE;	
ELSE
	IF THIS^.ActiveDevice THEN
		RequestMaster := TRUE;
	ELSIF BusController^.BusOcupied = TRUE THEN
		RequestMaster := FALSE;	
	ELSIF timerData1.Q OR timerData2.Q OR timerData3.Q THEN
		RequestMaster := TRUE;	
		BusController^.SetBusOccupied();
		THIS^.ActiveDevice := TRUE;
	ELSE
		RequestMaster := FALSE;	
	END_IF
END_IF</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="GetRtuQuery">
              <interface>
                <returnType>
                  <derived name="RS485_RtuQuery" />
                </returnType>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF timerData1.Q THEN
	THIS^.timerData1.IN := FALSE;
	THIS^.ActiveRtuQuery := 1;
	GetRtuQuery := THIS^.Data1RtuQuery;
ELSIF timerData2.Q THEN
	THIS^.timerData2.IN := FALSE;
	THIS^.ActiveRtuQuery := 2;
	GetRtuQuery := THIS^.Data2RtuQuery;
ELSIF timerData3.Q THEN
	THIS^.timerData3.IN := FALSE;
	THIS^.ActiveRtuQuery := 3;
	GetRtuQuery := THIS^.Data3RtuQuery;	
END_IF</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_VIRTUAL_BOOL_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttQos">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="MqttRetain">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UpdateFlag">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VirtualMode">
              <type>
                <derived name="VIRTUAL_MODES" />
              </type>
            </variable>
            <variable name="DefaultValue">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SetDefaultValueStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PublishAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UsePersistentAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ConfirmReceival">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttMessageReceived">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PreviousIn">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousState">
              <type>
                <BOOL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF VirtualMode = VIRTUAL_MODES.Output THEN
	IF (Startup AND PublishAtStartup) OR (UpdateFlag OR IN &lt;&gt; PreviousIn) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(IN),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	UpdateFlag := FALSE;
	PreviousIn := IN;
	END_IF
ELSIF VirtualMode = VIRTUAL_MODES.Input THEN
	IF Startup AND SetDefaultValueStartup THEN
		OUT := DefaultValue;
	ELSIF UsePersistentAtStartup THEN
		OUT := PreviousState;
	END_IF	
	
	IF (Startup AND PublishAtStartup) OR (ConfirmReceival AND MqttMessageReceived) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := BOOL_TO_STRING(OUT),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	MqttMessageReceived := FALSE;
	PreviousState:=OUT;
	END_IF		
	
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MqttQos">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="MqttRetain">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

THIS^.MqttQos:=MqttQos;
THIS^.MqttRetain:=MqttRetain;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized and FB in input mode, otherwise do nothing
IF NOT(InitMqttDone) AND VirtualMode &lt;&gt; VIRTUAL_MODES.Input THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//process the data
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('TRUE')) THEN
		THIS^.OUT := TRUE;
		MqttMessageReceived := TRUE;
	END_IF
	IF CommonTypesAndFunctions.StrEquals(str1:= Data.PayloadString, str2:= ADR('FALSE')) THEN
		THIS^.OUT := FALSE;
		MqttMessageReceived := TRUE;
	END_IF
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualInput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="DefaultValue">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="SetDefaultValueStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="UsePersistentAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="ConfirmReceival">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.DefaultValue:=DefaultValue;
THIS^.SetDefaultValueStartup:=SetDefaultValueStartup;
THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.UsePersistentAtStartup:=UsePersistentAtStartup;
THIS^.ConfirmReceival:=ConfirmReceival;
THIS^.VirtualMode:=VIRTUAL_MODES.Input;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetValue">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Value">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.OUT:=Value;
THIS^.UpdateFlag:=TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualOutput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.VirtualMode:=VIRTUAL_MODES.Output;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_VIRTUAL_INT_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttQos">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="MqttRetain">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UpdateFlag">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VirtualMode">
              <type>
                <derived name="VIRTUAL_MODES" />
              </type>
            </variable>
            <variable name="DefaultValue">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="SetDefaultValueStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PublishAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UsePersistentAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ConfirmReceival">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttMessageReceived">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PreviousIn">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousState">
              <type>
                <INT />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF VirtualMode = VIRTUAL_MODES.Output THEN
	IF (Startup AND PublishAtStartup) OR (UpdateFlag OR IN &lt;&gt; PreviousIn) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := INT_TO_STRING(IN),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	UpdateFlag := FALSE;
	PreviousIn := IN;
	END_IF
ELSIF VirtualMode = VIRTUAL_MODES.Input THEN
	IF Startup AND SetDefaultValueStartup THEN
		OUT := DefaultValue;
	ELSIF UsePersistentAtStartup THEN
		OUT := PreviousState;
	END_IF	
	
	IF (Startup AND PublishAtStartup) OR (ConfirmReceival AND MqttMessageReceived) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := INT_TO_STRING(OUT),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	MqttMessageReceived := FALSE;
	PreviousState:=OUT;
	END_IF		
	
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualOutput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.VirtualMode:=VIRTUAL_MODES.Output;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MqttQos">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="MqttRetain">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

THIS^.MqttQos:=MqttQos;
THIS^.MqttRetain:=MqttRetain;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized and FB in input mode, otherwise do nothing
IF NOT(InitMqttDone) AND VirtualMode &lt;&gt; VIRTUAL_MODES.Input THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//process the data
	IF OSCAT_BASIC.IS_NUM(str:= Data.PayloadString^) THEN
		THIS^.OUT := STRING_TO_INT(Data.PayloadString^);	
		MqttMessageReceived := TRUE;	
	END_IF
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualInput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="DefaultValue">
                    <type>
                      <INT />
                    </type>
                  </variable>
                  <variable name="SetDefaultValueStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="UsePersistentAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="ConfirmReceival">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.DefaultValue:=DefaultValue;
THIS^.SetDefaultValueStartup:=SetDefaultValueStartup;
THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.UsePersistentAtStartup:=UsePersistentAtStartup;
THIS^.ConfirmReceival:=ConfirmReceival;
THIS^.VirtualMode:=VIRTUAL_MODES.Input;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetValue">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Value">
                    <type>
                      <INT />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.OUT:=Value;
THIS^.UpdateFlag:=TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_VIRTUAL_REAL_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttQos">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="MqttRetain">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UpdateFlag">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VirtualMode">
              <type>
                <derived name="VIRTUAL_MODES" />
              </type>
            </variable>
            <variable name="DefaultValue">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SetDefaultValueStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PublishAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UsePersistentAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ConfirmReceival">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttMessageReceived">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PreviousIn">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousState">
              <type>
                <REAL />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF VirtualMode = VIRTUAL_MODES.Output THEN
	IF (Startup AND PublishAtStartup) OR (UpdateFlag OR IN &lt;&gt; PreviousIn) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := REAL_TO_STRING(IN),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	UpdateFlag := FALSE;
	PreviousIn := IN;
	END_IF
ELSIF VirtualMode = VIRTUAL_MODES.Input THEN
	IF Startup AND SetDefaultValueStartup THEN
		OUT := DefaultValue;
	ELSIF UsePersistentAtStartup THEN
		OUT := PreviousState;
	END_IF	
	
	IF (Startup AND PublishAtStartup) OR (ConfirmReceival AND MqttMessageReceived) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := REAL_TO_STRING(OUT),
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	MqttMessageReceived := FALSE;
	PreviousState:=OUT;
	END_IF		
	
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualOutput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.VirtualMode:=VIRTUAL_MODES.Output;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MqttQos">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="MqttRetain">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

THIS^.MqttQos:=MqttQos;
THIS^.MqttRetain:=MqttRetain;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized and FB in input mode, otherwise do nothing
IF NOT(InitMqttDone) AND VirtualMode &lt;&gt; VIRTUAL_MODES.Input THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//process the data
	THIS^.OUT := STRING_TO_REAL(Data.PayloadString^);	
	MqttMessageReceived := TRUE;	
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualInput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="DefaultValue">
                    <type>
                      <REAL />
                    </type>
                  </variable>
                  <variable name="SetDefaultValueStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="UsePersistentAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="ConfirmReceival">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.DefaultValue:=DefaultValue;
THIS^.SetDefaultValueStartup:=SetDefaultValueStartup;
THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.UsePersistentAtStartup:=UsePersistentAtStartup;
THIS^.ConfirmReceival:=ConfirmReceival;
THIS^.VirtualMode:=VIRTUAL_MODES.Input;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetValue">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Value">
                    <type>
                      <REAL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.OUT:=Value;
THIS^.UpdateFlag:=TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="FB_VIRTUAL_STRING_MQTT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <string />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <string />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="InstanceName">
              <type>
                <string />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="instance-path" Value="" />
                    <Attribute Name="noinit" Value="" />
                  </Attributes>
                </data>
              </addData>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> object's full instance name </xhtml>
              </documentation>
            </variable>
            <variable name="Startup">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="InitMqttDone">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttPublishTopicPrefix">
              <type>
                <pointer>
                  <baseType>
                    <string />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttPublishTopicSuffix">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="MQTTSubscribeTopic">
              <type>
                <string length="50" />
              </type>
            </variable>
            <variable name="pMqttPublishQueue">
              <type>
                <pointer>
                  <baseType>
                    <derived name="FB_MqttPublishQueue" />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="MqttQos">
              <type>
                <derived name="SD_MQTT.QoS" />
              </type>
            </variable>
            <variable name="MqttRetain">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UpdateFlag">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VirtualMode">
              <type>
                <derived name="VIRTUAL_MODES" />
              </type>
            </variable>
            <variable name="DefaultValue">
              <type>
                <string />
              </type>
            </variable>
            <variable name="SetDefaultValueStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PublishAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UsePersistentAtStartup">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ConfirmReceival">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MqttMessageReceived">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PreviousIn">
              <type>
                <string />
              </type>
            </variable>
          </localVars>
          <localVars persistent="true">
            <variable name="PreviousState">
              <type>
                <string />
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> To retain output state through powercycles</xhtml>
              </documentation>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/pouinheritance" handleUnknown="implementation">
              <Inheritance>
                <Implements>SD_MQTT.MQTT_SUBSCRIBE_CALLBACK</Implements>
              </Inheritance>
            </data>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="reflection" Value="" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF VirtualMode = VIRTUAL_MODES.Output THEN
	IF (Startup AND PublishAtStartup) OR (UpdateFlag OR IN &lt;&gt; PreviousIn) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := IN,
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	UpdateFlag := FALSE;
	PreviousIn := IN;
	END_IF
ELSIF VirtualMode = VIRTUAL_MODES.Input THEN
	IF Startup AND SetDefaultValueStartup THEN
		OUT := DefaultValue;
	ELSIF UsePersistentAtStartup THEN
		OUT := PreviousState;
	END_IF	
	
	IF (Startup AND PublishAtStartup) OR (ConfirmReceival AND MqttMessageReceived) AND InitMqttDone THEN
	pMqttPublishQueue^.AddMessage(
		Payload := OUT,
		Topic := CONCAT(MqttPublishTopicPrefix^, MqttPublishTopicSuffix),
		Qos := MqttQos,
		MqttRetain := MqttRetain
	);
	Startup:=FALSE;
	MqttMessageReceived := FALSE;
	PreviousState:=OUT;
	END_IF		
	
END_IF</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="InitMqtt">
              <interface>
                <inputVars>
                  <variable name="MQTTPublishPrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MQTTSubscribePrefix">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttPublishQueue">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="FB_MqttPublishQueue" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="pMqttCallbackCollector">
                    <type>
                      <pointer>
                        <baseType>
                          <derived name="SD_MQTT.CallbackCollector" />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                  <variable name="MqttQos">
                    <type>
                      <derived name="SD_MQTT.QoS" />
                    </type>
                  </variable>
                  <variable name="MqttRetain">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="InstanceNamePt">
                    <type>
                      <pointer>
                        <baseType>
                          <string />
                        </baseType>
                      </pointer>
                    </type>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.pMqttPublishQueue := pMqttPublishQueue;
THIS^.MqttPublishTopicPrefix := MQTTPublishPrefix;

InstanceNamePt := CommonTypesAndFunctions.FindLastDot(ADR(THIS^.InstanceName)) + 1;
THIS^.MqttPublishTopicSuffix := InstanceNamePt^;
THIS^.MQTTSubscribeTopic := CONCAT(MQTTSubscribePrefix^ ,THIS^.MqttPublishTopicSuffix);

// register the FB agains the collector so mqtt events can be received
pMqttCallbackCollector^.put(instance:= THIS^);

THIS^.MqttQos:=MqttQos;
THIS^.MqttRetain:=MqttRetain;

InitMqttDone := TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="PublishReceived">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Data">
                    <type>
                      <derived name="SD_MQTT.CALLBACK_DATA" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">Collection of recived Data</xhtml>
                    </documentation>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">//first check if Mqtt is initialized and FB in input mode, otherwise do nothing
IF NOT(InitMqttDone) AND VirtualMode &lt;&gt; VIRTUAL_MODES.Input THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
//check if the packet is for this FB
ELSIF CommonTypesAndFunctions.StrEquals(str1:= ADR(MQTTSubscribeTopic), str2:= Data.TopicOut) THEN
	//mark the interface call from the collector as done
	PublishReceived := TRUE;
	//process the data
	THIS^.OUT := Data.PayloadString^;	
	MqttMessageReceived := TRUE;
END_IF </xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualInput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="DefaultValue">
                    <type>
                      <string />
                    </type>
                  </variable>
                  <variable name="SetDefaultValueStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="UsePersistentAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                  <variable name="ConfirmReceival">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.DefaultValue:=DefaultValue;
THIS^.SetDefaultValueStartup:=SetDefaultValueStartup;
THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.UsePersistentAtStartup:=UsePersistentAtStartup;
THIS^.ConfirmReceival:=ConfirmReceival;
THIS^.VirtualMode:=VIRTUAL_MODES.Input;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetValue">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="Value">
                    <type>
                      <string />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.OUT:=Value;
THIS^.UpdateFlag:=TRUE;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="ConfigureFunctionBlockAsVirtualOutput">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="PublishAtStartup">
                    <type>
                      <BOOL />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.PublishAtStartup:=PublishAtStartup;
THIS^.VirtualMode:=VIRTUAL_MODES.Output;</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="RMP_B" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="BUSY">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="HIGH">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="LOW">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="rmp">
              <type>
                <derived name="_RMP_B" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">(* generate ramp *)
rmp(dir := UP, E := E, TR := PT, rmp := out);

(* set or reset operation *)
IF RST THEN
	out := 0;
ELSIF SET THEN
	out := 255;
END_IF;

(* checks for outputs stable and reset or set busy flag *)
low := out = 0;
high := out = 255;
busy := NOT (low OR high) AND E;


(* revision history

hm 5.10.2006	rev 1.1
	added busy output
hm 17.1.2007	rev 1.2
	renamed input ud to up for better usability
	deleted unused variable step

hm	17.9.2007		rev 1.3
	replaced time() with t_plc_ms() for compatibility reasons

hm	28. sep 2007	rev 1.4
	added outputs on and off
	busy is now disabled while en is false
	new coding for higher accuracy and performance

hm	5. oct 2007	rev 1.5
	added statements to allow for PT to be t#0s output jumps to max or min immediately

hm	25. dec 2007	rev 1.6
	improved code for better performance

hm	16. oct. 2008	rev 1.7
	improved code for better performance

hm	18. oct. 2008	rev 1.8
	added type conversion to avoid warnings
	changed input en to e for compatibility reasons

hm	23. oct. 2008	REV 	2.0
	new code using _RMP_B

*)</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="SetRMP">
              <interface>
                <inputVars>
                  <variable name="RMP">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">THIS^.OUT:=RMP;
THIS^.rmp.SetRMP(RMP);</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
        </addData>
      </pou>
      <pou name="SwapWordsToReal" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="wHi">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="wLo">
              <type>
                <WORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="dwVar">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="pt_REAL">
              <type>
                <pointer>
                  <baseType>
                    <REAL />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">dwVar := SHL(WORD_TO_DWORD(wHi),16) OR WORD_TO_DWORD(wLo);
pt_REAL := ADR(dwVar);
SwapWordsToReal := pt_REAL^;</xhtml>
          </ST>
        </body>
        <addData />
      </pou>
    </pous>
  </types>
  <instances>
    <configurations />
  </instances>
  <addData>
    <data name="http://www.3s-software.com/plcopenxml/interface" handleUnknown="implementation">
      <Interface name="RS485Device">
        <Methods>
          <Method name="RequestMaster">
            <interface>
              <returnType>
                <BOOL />
              </returnType>
              <inputVars>
                <variable name="BusController">
                  <type>
                    <pointer>
                      <baseType>
                        <derived name="FB_RS485_BUSCONTROLLER" />
                      </baseType>
                    </pointer>
                  </type>
                </variable>
              </inputVars>
            </interface>
            <addData />
          </Method>
          <Method name="GetRtuQuery">
            <interface>
              <returnType>
                <derived name="RS485_RtuQuery" />
              </returnType>
            </interface>
            <addData />
          </Method>
          <Method name="ProcessDataArray">
            <interface>
              <inputVars>
                <variable name="Error">
                  <type>
                    <BOOL />
                  </type>
                </variable>
                <variable name="Data">
                  <type>
                    <pointer>
                      <baseType>
                        <array>
                          <dimension lower="0" upper="124" />
                          <baseType>
                            <WORD />
                          </baseType>
                        </array>
                      </baseType>
                    </pointer>
                  </type>
                </variable>
              </inputVars>
            </interface>
            <addData />
          </Method>
        </Methods>
        <addData />
      </Interface>
    </data>
    <data name="http://www.3s-software.com/plcopenxml/application" handleUnknown="implementation">
      <resource name="HomeAutomation">
        <task name="MainTask" interval="PT0.05S" priority="4">
          <pouInstance name="PLC_PRG_MAIN" typeName="">
            <documentation>
              <xhtml xmlns="http://www.w3.org/1999/xhtml" />
            </documentation>
          </pouInstance>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/tasksettings" handleUnknown="implementation">
              <TaskSettings KindOfTask="Cyclic" Interval="50" IntervalUnit="ms" WithinSPSTimeSlicing="true">
                <Watchdog Enabled="false" TimeUnit="ms" Sensitivity="1" />
              </TaskSettings>
            </data>
          </addData>
        </task>
        <task name="MqttCommunication" priority="5">
          <pouInstance name="PLC_PRG_MQTT" typeName="">
            <documentation>
              <xhtml xmlns="http://www.w3.org/1999/xhtml" />
            </documentation>
          </pouInstance>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/tasksettings" handleUnknown="implementation">
              <TaskSettings KindOfTask="Freewheeling" Interval="t#20ms" IntervalUnit="ms" WithinSPSTimeSlicing="true">
                <Watchdog Enabled="false" TimeUnit="ms" Sensitivity="1" />
              </TaskSettings>
            </data>
          </addData>
        </task>
        <task name="RS485" interval="PT0.2S" priority="15">
          <pouInstance name="PLC_PRG_RS485" typeName="">
            <documentation>
              <xhtml xmlns="http://www.w3.org/1999/xhtml" />
            </documentation>
          </pouInstance>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/tasksettings" handleUnknown="implementation">
              <TaskSettings KindOfTask="Cyclic" Interval="200" IntervalUnit="ms" ExternalEvent="LocalBusCycleEvent" WithinSPSTimeSlicing="true">
                <Watchdog Enabled="false" TimeUnit="ms" Sensitivity="1" />
              </TaskSettings>
            </data>
          </addData>
        </task>
        <globalVars name="MqttVariables">
          <variable name="fbMqttPublishQueue">
            <type>
              <derived name="FB_MqttPublishQueue" />
            </type>
            <documentation>
              <xhtml xmlns="http://www.w3.org/1999/xhtml"> Shared Variables for MQTT publish communication </xhtml>
            </documentation>
          </variable>
          <variable name="collector_FB_OUTPUT_SWITCH_MQTT">
            <type>
              <derived name="SD_MQTT.CallbackCollector" />
            </type>
            <documentation>
              <xhtml xmlns="http://www.w3.org/1999/xhtml"> Shared Variables for MQTT subscribe communication </xhtml>
            </documentation>
          </variable>
          <variable name="collector_FB_OUTPUT_COVER_MQTT">
            <type>
              <derived name="SD_MQTT.CallbackCollector" />
            </type>
          </variable>
          <variable name="collector_FB_VIRTUAL_MQTT">
            <type>
              <derived name="SD_MQTT.CallbackCollector" />
            </type>
          </variable>
          <variable name="collector_FB_DIMMER_MQTT">
            <type>
              <derived name="SD_MQTT.CallbackCollector" />
            </type>
          </variable>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="qualified_only" Value="" />
              </Attributes>
            </data>
          </addData>
        </globalVars>
        <globalVars name="PersistentVars">
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="qualified_only" Value="" />
                <Attribute Name="checksumnoinit_override" Value="4063316687" />
                <Attribute Name="init_related_code" Value="e2545669-e23e-45fa-90bb-dcdbc35c83a4" />
              </Attributes>
            </data>
          </addData>
        </globalVars>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/pou" handleUnknown="implementation">
            <pou name="PLC_PRG_MAIN" pouType="program">
              <interface>
                <localVars>
                  <variable name="MqttPushbuttonPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/DigitalInputs/Pushbuttons/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> INPUT FUNCTION BLOCKS </xhtml>
                    </documentation>
                  </variable>
                  <variable name="FB_DI_PB_001">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_002">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_003">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_004">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_005">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_006">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_007">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_008">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_009">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_DIMMER_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_010">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_011">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_012">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_013">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_014">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_015">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_016">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_017">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_018">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_019">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_020">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_021">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_022">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_023">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_024">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_025">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_026">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_027">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_028">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_029">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_030">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_031">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_032">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_033">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_034">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_035">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_036">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_037">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_038">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_039">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_040">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_041">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_042">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_043">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_044">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_045">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_046">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_047">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DI_PB_048">
                    <type>
                      <derived name="FB_INPUT_PUSHBUTTON_MQTT" />
                    </type>
                  </variable>
                  <variable name="MqttPubSwitchPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/DigitalOutputs/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> OUTPUT FUNCTION BLOCKS </xhtml>
                    </documentation>
                  </variable>
                  <variable name="MqttSubSwitchPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/In/DigitalOutputs/'" />
                    </initialValue>
                  </variable>
                  <variable name="FB_DO_SW_001">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_002">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_003">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_004">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_005">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_006">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_007">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_008">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_009">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_010">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_011">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_012">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_013">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_014">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_015">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_016">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_017">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_018">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_019">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_020">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_021">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_022">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_023">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_024">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_025">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_026">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_027">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_028">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_029">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_030">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_031">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_DO_SW_032">
                    <type>
                      <derived name="FB_OUTPUT_SWITCH_MQTT" />
                    </type>
                  </variable>
                  <variable name="MqttPubCoverPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/Covers/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> COVER FUNCTION BLOCKS </xhtml>
                    </documentation>
                  </variable>
                  <variable name="MqttSubCoverPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/In/Covers/'" />
                    </initialValue>
                  </variable>
                  <variable name="FB_DO_COVER_001">
                    <type>
                      <derived name="FB_OUTPUT_COVER_MQTT" />
                    </type>
                  </variable>
                  <variable name="MqttPubDimmerPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/Dimmers/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> DIMMER FUNCTION BLOCKS </xhtml>
                    </documentation>
                  </variable>
                  <variable name="MqttSubDimmerPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/In/Dimmers/'" />
                    </initialValue>
                  </variable>
                  <variable name="FB_AO_DIMMER_001">
                    <type>
                      <derived name="FB_OUTPUT_DIMMER_MQTT" />
                    </type>
                  </variable>
                  <variable name="TestOUT">
                    <type>
                      <BYTE />
                    </type>
                  </variable>
                  <variable name="MqttPubVirtualPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/Virtuals/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> VIRTUAL FUNCTION BLOCKS </xhtml>
                    </documentation>
                  </variable>
                  <variable name="MqttSubVirtualPrefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/In/Virtuals/'" />
                    </initialValue>
                  </variable>
                  <variable name="FB_VIRTUAL_INT_001">
                    <type>
                      <derived name="FB_VIRTUAL_INT_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_VIRTUAL_BOOL_001">
                    <type>
                      <derived name="FB_VIRTUAL_BOOL_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_VIRTUAL_STRING_001">
                    <type>
                      <derived name="FB_VIRTUAL_STRING_MQTT" />
                    </type>
                  </variable>
                  <variable name="FB_VIRTUAL_REAL_001">
                    <type>
                      <derived name="FB_VIRTUAL_REAL_MQTT" />
                    </type>
                  </variable>
                </localVars>
              </interface>
              <actions>
                <action name="READ_PUSHBUTTONS">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DI_PB_001(PB:= DI_001); (* Provide the input FB the correct phyical input to validate each cyclus *)
FB_DI_PB_002(PB:= DI_002);
FB_DI_PB_003(PB:= DI_003);
FB_DI_PB_004(PB:= DI_004);
FB_DI_PB_005(PB:= DI_005);
FB_DI_PB_006(PB:= DI_006);
FB_DI_PB_007(PB:= DI_007);
FB_DI_PB_008(PB:= DI_008);
FB_DI_PB_009(PB:= DI_009);
FB_DI_PB_010(PB:= DI_010);
FB_DI_PB_011(PB:= DI_011);
FB_DI_PB_012(PB:= DI_012);
FB_DI_PB_013(PB:= DI_013);
FB_DI_PB_014(PB:= DI_014);
FB_DI_PB_015(PB:= DI_015);
FB_DI_PB_016(PB:= DI_016);
FB_DI_PB_017(PB:= DI_017);
FB_DI_PB_018(PB:= DI_018);
FB_DI_PB_019(PB:= DI_019);
FB_DI_PB_020(PB:= DI_020);
FB_DI_PB_021(PB:= DI_021);
FB_DI_PB_022(PB:= DI_022);
FB_DI_PB_023(PB:= DI_023);
FB_DI_PB_024(PB:= DI_024);
FB_DI_PB_025(PB:= DI_025);
FB_DI_PB_026(PB:= DI_026);
FB_DI_PB_027(PB:= DI_027);
FB_DI_PB_028(PB:= DI_028);
FB_DI_PB_029(PB:= DI_029);
FB_DI_PB_030(PB:= DI_030);
FB_DI_PB_031(PB:= DI_031);
FB_DI_PB_032(PB:= DI_032);
FB_DI_PB_033(PB:= DI_033);
FB_DI_PB_034(PB:= DI_034);
FB_DI_PB_035(PB:= DI_035);
FB_DI_PB_036(PB:= DI_036);
FB_DI_PB_037(PB:= DI_037);
FB_DI_PB_038(PB:= DI_038);
FB_DI_PB_039(PB:= DI_039);
FB_DI_PB_040(PB:= DI_040);
FB_DI_PB_041(PB:= DI_041);
FB_DI_PB_042(PB:= DI_042);
FB_DI_PB_043(PB:= DI_043);
FB_DI_PB_044(PB:= DI_044);
FB_DI_PB_045(PB:= DI_045);
FB_DI_PB_046(PB:= DI_046);
FB_DI_PB_047(PB:= DI_047);
FB_DI_PB_048(PB:= DI_048);</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="WRITE_SWITCHES">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DO_SW_001(OUT	=&gt;		DO_001,										(* couple the function block to the physical output *)
	PRIO_HIGH				:=FALSE,  									(* brings the output high regardless of other input values *)
	PRIO_LOW				:=FALSE, 									(* brings the output low regardless of other input values. NOTE: PRIO_HIGH overrules PRIO_LOW input *)
	TOGGLE					:=FB_DI_PB_009.SINGLE 						(* for toggling the output *)	
);

FB_DO_SW_002(OUT =&gt; DO_002		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.DOUBLE	);
FB_DO_SW_003(OUT =&gt; DO_003		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_004(OUT =&gt; DO_004		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_005(OUT =&gt; DO_005		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_006(OUT =&gt; DO_006		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_007(OUT =&gt; DO_007		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_008(OUT =&gt; DO_008		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FB_DI_PB_009.LONG		);
FB_DO_SW_009(OUT =&gt; DO_009		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_010(OUT =&gt; DO_010		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_011(OUT =&gt; DO_011		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_012(OUT =&gt; DO_012		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_013(OUT =&gt; DO_013		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_014(OUT =&gt; DO_014		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_015(OUT =&gt; DO_015		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_016(OUT =&gt; DO_016		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_017(OUT =&gt; DO_017		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_018(OUT =&gt; DO_018		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_019(OUT =&gt; DO_019		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_020(OUT =&gt; DO_020		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_021(OUT =&gt; DO_021		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_022(OUT =&gt; DO_022		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_023(OUT =&gt; DO_023		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_024(OUT =&gt; DO_024		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_025(OUT =&gt; DO_025		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_026(OUT =&gt; DO_026		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_027(OUT =&gt; DO_027		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_028(OUT =&gt; DO_028		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_029(OUT =&gt; DO_029		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);
FB_DO_SW_030(OUT =&gt; DO_030		,PRIO_HIGH:=FALSE			,PRIO_LOW:=FALSE				,TOGGLE:=FALSE				);


FB_AO_DIMMER_001(SINGLE:=FB_DI_PB_041.SINGLE, DOUBLE:=FB_DI_PB_041.DOUBLE, LONG:=FB_DI_PB_041.LONG, P_LONG:=FB_DI_PB_041.P_LONG, OUT := TestOUT);</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="MAIN_INIT">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">(* INIT DIGITAL INPUT STUFF *)
FB_DI_PB_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	(* pointer to string prefix for the mqtt publish topic *)
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue)		(* pointer to MqttPublishQueue to send a new Mqtt event *)
);
FB_DI_PB_002.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_003.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_004.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_005.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_006.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_007.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_008.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_009.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), TRUE, SD_MQTT.QoS.ExactlyOnce, 5);
FB_DI_PB_010.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_011.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_012.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_013.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_014.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_015.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_016.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));
FB_DI_PB_041.InitMqtt(MQTTPublishPrefix:= ADR(MqttPushbuttonPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue));

(* INIT DIMMER OUTPUT STUFF *)
FB_AO_DIMMER_001.InitMQTT(MQTTPublishPrefix:= ADR(MqttPubDimmerPrefix),    (* pointer to string prefix for the MQTT publish topic *)
	MQTTSubscribePrefix:= ADR(MqttSubDimmerPrefix),
    pMQTTPublishQueue := ADR(MQTTVariables.fbMQTTPublishQueue),         (* pointer to MQTTPublishQueue to send a new MQTT event *)
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_DIMMER_MQTT),	(* pointer to CallbackCollector to receive Mqtt subscription events *)
    TRUE,                                                               (* specify whether dimmer value should be outputted on MQTT topic *)
    SD_MQTT.QoS.ExactlyOnce,                                            (* specify the QoS for the dimmer mqtt events (values 0-255) *)    
    5                                                                   (* specify the resolution for the dimmer mqtt events *)    
);

(* INIT DIGITAL OUTPUT STUFF *)
FB_DO_SW_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),					(* pointer to string prefix for the mqtt publish topic *)
	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),									(* pointer to string prefix for the mqtt subscribe topic *)
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						(* pointer to MqttPublishQueue to send a new Mqtt event *)
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT)	(* pointer to CallbackCollector to receive Mqtt subscription events *)
);
FB_DO_SW_002.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_003.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_004.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_005.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_006.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_007.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_008.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_009.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_010.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_011.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix),	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_012.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_013.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_014.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_015.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_016.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_017.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_018.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_019.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_020.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_021.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_022.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_023.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_024.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_025.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_026.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_027.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_028.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_029.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));
FB_DO_SW_030.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubSwitchPrefix),	MQTTSubscribePrefix:= ADR(MqttSubSwitchPrefix), pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue), pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT));

(* INIT COVERS STUFF *)
FB_DO_COVER_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubCoverPrefix),				(* pointer to string prefix for the mqtt publish topic *)
	MQTTSubscribePrefix:= ADR(MqttSubCoverPrefix),									(* pointer to string prefix for the mqtt subscribe topic *)
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						(* pointer to MqttPublishQueue to send a new Mqtt event *)
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_OUTPUT_COVER_MQTT), 	(* pointer to CallbackCollector to receive Mqtt subscription events *)
	SD_MQTT.QoS.ExactlyOnce, 														(* specify the QoS for the POS mqtt events (values 0-100) *)
	2																				(* specify the resolution for the POS mqtt events *)
);

FB_DO_COVER_001.ConfigureFunctionBlock(T_LOCKOUT:=T#1S,								(* delay between change of direction *)
	T_UD:=T#20S																		(* run time to move the cover completely up/down *)
);

(* INIT VIRTUAL STUFF *)
FB_VIRTUAL_STRING_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubVirtualPrefix),				
	MQTTSubscribePrefix:= ADR(MqttSubVirtualPrefix),									
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_VIRTUAL_MQTT),
	MqttQos:=SD_MQTT.QoS.ExactlyOnce, 
	MqttRetain:=FALSE									
);
FB_VIRTUAL_STRING_001.ConfigureFunctionBlockAsVirtualInput(DefaultValue:='HelloWorld',SetDefaultValueStartup:=TRUE,PublishAtStartup:=TRUE,UsePersistentAtStartup:=FALSE,ConfirmReceival:=TRUE);


FB_VIRTUAL_INT_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubVirtualPrefix),				
	MQTTSubscribePrefix:= ADR(MqttSubVirtualPrefix),									
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_VIRTUAL_MQTT),
	MqttQos:=SD_MQTT.QoS.ExactlyOnce, 
	MqttRetain:=FALSE												
);
FB_VIRTUAL_INT_001.ConfigureFunctionBlockAsVirtualInput(DefaultValue:=0,SetDefaultValueStartup:=TRUE,PublishAtStartup:=TRUE,UsePersistentAtStartup:=FALSE,ConfirmReceival:=TRUE);
(* FB_VIRTUAL_INT_001.ConfigureFunctionBlockAsVirtualOutput(PublishAtStartup:=TRUE); *)


FB_VIRTUAL_BOOL_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubVirtualPrefix),				
	MQTTSubscribePrefix:= ADR(MqttSubVirtualPrefix),									
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_VIRTUAL_MQTT),
	MqttQos:=SD_MQTT.QoS.ExactlyOnce, 
	MqttRetain:=FALSE											
);
(* FB_VIRTUAL_BOOL_001.ConfigureFunctionBlockAsVirtualInput(DefaultValue:=FALSE,SetDefaultValueStartup:=TRUE,PublishAtStartup:=TRUE,UsePersistentAtStartup:=FALSE); *)
FB_VIRTUAL_BOOL_001.ConfigureFunctionBlockAsVirtualOutput(PublishAtStartup:=TRUE);

FB_VIRTUAL_REAL_001.InitMqtt(MQTTPublishPrefix:= ADR(MqttPubVirtualPrefix),				
	MQTTSubscribePrefix:= ADR(MqttSubVirtualPrefix),									
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue),						
	pMqttCallbackCollector := ADR(MqttVariables.collector_FB_VIRTUAL_MQTT),
	MqttQos:=SD_MQTT.QoS.ExactlyOnce, 
	MqttRetain:=FALSE												
);
FB_VIRTUAL_REAL_001.ConfigureFunctionBlockAsVirtualInput(DefaultValue:=0.1,SetDefaultValueStartup:=TRUE,PublishAtStartup:=TRUE,UsePersistentAtStartup:=FALSE,ConfirmReceival:=TRUE);
(* FB_VIRTUAL_REAL_001.ConfigureFunctionBlockAsVirtualOutput(PublishAtStartup:=TRUE); *)
</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="MOVE_COVERS">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_DO_COVER_001(
	UP:=FB_DI_PB_013.P_LONG,
	DN:=FB_DI_PB_015.P_LONG,
	MU=&gt;DO_031,
	MD=&gt;DO_032	
	);</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="PROCESS_VIRTUAL">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">
FB_VIRTUAL_BOOL_001();
FB_VIRTUAL_INT_001();
FB_VIRTUAL_STRING_001();
FB_VIRTUAL_REAL_001();</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
              </actions>
              <body>
                <SFC>
                  <step localId="0" initialStep="true" name="Init">
                    <position x="0" y="0" />
                    <connectionPointIn />
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">Init</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">TRUE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="2">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" />
                    </connectionPointIn>
                    <action localId="1" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="MAIN_INIT" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MAIN_INIT</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="3">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>True</expression>
                  </inVariable>
                  <transition localId="4">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="3" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">True</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <step localId="5" name="Main">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="4" />
                    </connectionPointIn>
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">Main</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">FALSE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="10">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" />
                    </connectionPointIn>
                    <action localId="6" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="READ_PUSHBUTTONS" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">READ_PUSHBUTTONS</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                    <action localId="7" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="WRITE_SWITCHES" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">WRITE_SWITCHES</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                    <action localId="8" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="MOVE_COVERS" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MOVE_COVERS</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                    <action localId="9" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="PROCESS_VIRTUAL" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">PROCESS_VIRTUAL</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="11">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>TRUE</expression>
                  </inVariable>
                  <transition localId="12">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="11" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">TRUE</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <jumpStep localId="13" targetName="Main">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="12" />
                    </connectionPointIn>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">Main</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </jumpStep>
                </SFC>
              </body>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/sfcsettings" handleUnknown="implementation">
                  <SFCSettings>
                    <LibTitle>IecSfc</LibTitle>
                    <LibCompany>System</LibCompany>
                    <LibVersion>3.4.2.0</LibVersion>
                    <LibNamespace>IecSfc</LibNamespace>
                    <CalcActiveTransOnly>false</CalcActiveTransOnly>
                    <UseDefaults>false</UseDefaults>
                    <Flags>
                      <EnableLimit Declare="true" Use="false" />
                      <Init Declare="true" Use="false" />
                      <Reset Declare="true" Use="false" />
                      <QuitError Declare="true" Use="false" />
                      <Pause Declare="true" Use="false" />
                      <Error Declare="true" Use="false" />
                      <Trans Declare="true" Use="false" />
                      <ErrorStep Declare="true" Use="false" />
                      <ErrorPOU Declare="true" Use="false" />
                      <CurrentStep Declare="true" Use="false" />
                      <Tip Declare="true" Use="false" />
                      <TipMode Declare="true" Use="false" />
                      <MaxFlags Declare="true" Use="false" />
                      <SFCErrorAnalyzation Declare="true" Use="false" />
                      <SFCErrorAnalyzationTable Declare="true" Use="false" />
                    </Flags>
                  </SFCSettings>
                </data>
              </addData>
            </pou>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/pou" handleUnknown="implementation">
            <pou name="PLC_PRG_MQTT" pouType="program">
              <interface>
                <localVars>
                  <variable name="broker">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'192.168.1.52:1883'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> variables for MQTT configuration </xhtml>
                    </documentation>
                  </variable>
                  <variable name="clientID">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200-HOUSE'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> use the below for username password authentication to broker 
 broker					:STRING:='user:password@192.168.1.36:1883'; 
 user led to indicate broker status, é!COCKPIT version 
 LED_1_BrokerStatus		:FbAppLED; </xhtml>
                    </documentation>
                  </variable>
                  <variable name="MQTTClient">
                    <type>
                      <derived name="SD_MQTT.HANDLE_MQTT" />
                    </type>
                  </variable>
                  <variable name="MQTT_IN_OUT">
                    <type>
                      <derived name="SD_MQTT.MQTT_IN_OUT" />
                    </type>
                  </variable>
                  <variable name="MQTTInfo">
                    <type>
                      <derived name="SD_MQTT.MQTT_INFO" />
                    </type>
                  </variable>
                  <variable name="MQTTLwtTopic">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'Devices/WAGO-PFC200/availability'" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTLwtPayload">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'offline'" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTBirthMessage">
                    <type>
                      <derived name="MQTT_MESSAGE" />
                    </type>
                  </variable>
                  <variable name="MQTTBirthTopic">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'Devices/WAGO-PFC200/availability'" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTBirthPayload">
                    <type>
                      <string />
                    </type>
                    <initialValue>
                      <simpleValue value="'online'" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTBirthHartbeat">
                    <type>
                      <derived name="OSCAT_BASIC.GEN_PULSE" />
                    </type>
                  </variable>
                  <variable name="MQTTBirthHartbeatTime">
                    <type>
                      <TIME />
                    </type>
                    <initialValue>
                      <simpleValue value="TIME#5s0ms" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTConnectTrigger">
                    <type>
                      <derived name="Standard.R_TRIG" />
                    </type>
                  </variable>
                  <variable name="MQTTPublishBirth">
                    <type>
                      <BOOL />
                    </type>
                    <initialValue>
                      <simpleValue value="TRUE" />
                    </initialValue>
                  </variable>
                  <variable name="MQTTBirthPublisher">
                    <type>
                      <derived name="FB_MqttPublishWorker" />
                    </type>
                  </variable>
                  <variable name="initMqtt">
                    <type>
                      <BOOL />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> variables for MQTT setup </xhtml>
                    </documentation>
                  </variable>
                  <variable name="icounter">
                    <type>
                      <UDINT />
                    </type>
                  </variable>
                  <variable name="ipublishers">
                    <type>
                      <UDINT />
                    </type>
                    <initialValue>
                      <simpleValue value="40" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> variables for MQTT publishing </xhtml>
                    </documentation>
                  </variable>
                  <variable name="publishers">
                    <type>
                      <array>
                        <dimension lower="0" upper="39" />
                        <baseType>
                          <derived name="FB_MqttPublishWorker" />
                        </baseType>
                      </array>
                    </type>
                  </variable>
                  <variable name="i">
                    <type>
                      <UDINT />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> variables to work with Mqttbuffer </xhtml>
                    </documentation>
                  </variable>
                  <variable name="subscriber_FB_OUTPUT_SWITCH_MQTT">
                    <type>
                      <derived name="SD_MQTT.MQTTSubscribe" />
                    </type>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> variables for MQTT subscribing </xhtml>
                    </documentation>
                  </variable>
                  <variable name="subscriber_FB_OUTPUT_COVER_MQTT">
                    <type>
                      <derived name="SD_MQTT.MQTTSubscribe" />
                    </type>
                  </variable>
                  <variable name="subscriber_FB_VIRTUAL_MQTT">
                    <type>
                      <derived name="SD_MQTT.MQTTSubscribe" />
                    </type>
                  </variable>
                  <variable name="subscriber_FB_DIMMER_MQTT">
                    <type>
                      <derived name="SD_MQTT.MQTTSubscribe" />
                    </type>
                  </variable>
                </localVars>
              </interface>
              <actions>
                <action name="MQTT_INIT">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">
IF NOT initMqtt THEN
	initMqtt := TRUE;
	(* Basic MQTT config *)
	MQTT_IN_OUT.ClientID := clientID;
	
	(* Set the LWT topic / payload *)
	MQTT_IN_OUT.BuildWillTopicAndMessage := FALSE;
	MQTT_IN_OUT.WillTopicBase := '';
	MQTT_IN_OUT.ClientWillTopic := MQTTLwtTopic;
	MQTT_IN_OUT.ClientWillMessage := MQTTLwtPayload;
	
	(* Set the birth message *)
	MQTTBirthMessage.Payload := MQTTBirthPayload;
	MQTTBirthMessage.Topic := MQTTBirthTopic;
	MQTTBirthMessage.Qos := SD_MQTT.QoS.ExactlyOnce;
	MQTTBirthMessage.MqttRetain := FALSE;
	
	(* Configure the rising edge detector to detect a connect/reconnect to the broker, used for  birth message *)
	MQTTConnectTrigger(CLK := MQTTInfo.MQTT_CONNECTED);
	
	(* Configure the dedicated MQTTBirth publisher *)
	MQTTBirthPublisher.Init(inputMQTT_IN_OUT:= ADR(MQTT_IN_OUT));
	
	(* Configure the pulse generator for the birth message hartbeat *)
	 MQTTBirthHartbeat(ENQ:=TRUE, PTH:=T#0S, PTL:=MQTTBirthHartbeatTime);
	
	(* INIT MQTT PUBLISH STUFF *)
	FOR icounter := 0 TO (ipublishers-1) DO		
		publishers[icounter].Init(inputMQTT_IN_OUT:= ADR(MQTT_IN_OUT));
	END_FOR 
	
	(* INIT MQTT SUBSCRIBE STUFF *)
	subscriber_FB_OUTPUT_SWITCH_MQTT.SetMqttInOut(MQTT_IN_OUT:= ADR(MQTT_IN_OUT));	
	subscriber_FB_OUTPUT_COVER_MQTT.SetMqttInOut(MQTT_IN_OUT:= ADR(MQTT_IN_OUT));
	subscriber_FB_VIRTUAL_MQTT.SetMqttInOut(MQTT_IN_OUT:= ADR(MQTT_IN_OUT));	
	subscriber_FB_DIMMER_MQTT.SetMqttInOut(MQTT_IN_OUT:= ADR(MQTT_IN_OUT));

END_IF

</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="MQTT_PUBLISH">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">(* set user led green if connected to MQTT broker, flashing red if not *)
(* é!COCKPIT version *)
(* LED_1_BrokerStatus(eID:=eLedID.AppLED_1, xOpen:=TRUE );
IF(MQTTClient.connected) THEN
	LED_1_BrokerStatus.SetStatic(eLedColor.Green);
ELSE
	LED_1_BrokerStatus.SetFlash(T#1S,eLedColor.Red, eLedColor.Off);  
END_IF *)
(* Codesys 3S version *)
(*
IF MQTTClient.connected THEN
     PFC.SetLed(which:=PFC.LED.U1, how:=PFC.LedState.STATIC_GRN);
ELSE
     PFC.SetLed(which:=PFC.LED.U1, how:=PFC.LedState.BLINK_RED);
END_IF 
*)

(* allow the rising edge detector to detect a connect/reconnect to the broker, used for  birth message *)
MQTTConnectTrigger(CLK := MQTTInfo.MQTT_CONNECTED);

(* allow the pulse generator to generate a pulse, used for birth message hartbeat *)
MQTTBirthHartbeat(ENQ:=TRUE, PTH:=T#0S, PTL:=MQTTBirthHartbeatTime);

(* Check if this is a new connection due to startup or connection issues *)
IF initMqtt AND (MQTTConnectTrigger.Q OR MQTTBirthHartbeat.Q) THEN
	MQTTPublishBirth := TRUE;
END_IF

(* On connect or reconnect publish a birth message using the dedicated birth publisher *)
IF MQTTPublishBirth THEN
	MQTTBirthPublisher.PublishMessage(MqttMessage := MQTTBirthMessage);
	MQTTPublishBirth:=FALSE;
END_IF


(* Check if Mqtt is initialized AND if there are elements on the queue to process AND if a MQTTbirthmessage has been published successfully *)
IF initMqtt AND NOT(MqttVariables.fbMqttPublishQueue.EMPTY) AND MQTTPublishBirth = FALSE AND MQTTBirthPublisher.SendDone THEN	
	(* Loop through all free publishers untill there are no more elements in the queue or no more free publishers *)
	FOR i:=0 TO (ipublishers-1) DO			
		(* use the publishers that are free  *)
		IF publishers[i].SendDone AND NOT(MqttVariables.fbMqttPublishQueue.EMPTY) THEN	
			(* Pass message from the queue to a publisher *)
			publishers[i].PublishMessage(MqttMessage:= MqttVariables.fbMqttPublishQueue.GetMessage());
		ELSIF MqttVariables.fbMqttPublishQueue.EMPTY THEN
			(* Queue is empty, jump out of the for loop	*)
			EXIT;	
		END_IF
	END_FOR
END_IF


(* If MQTT is initialized, let the MqttPublishWorkers do their work *)
IF initMqtt THEN
	MQTTClient(
		MQTT_IN_OUT:= MQTT_IN_OUT, 
		ENABLE:= TRUE, 
		URL:= broker, 
		TIMEOUT:= T#1S, 
		TLS:= FALSE);		
		
	MQTTBirthPublisher();
	
	FOR i := 0 TO (ipublishers-1) DO
  		publishers[i]();
	END_FOR

END_IF
</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="MQTT_SUBSCRIBE">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">(* If MQTT is initialized, let the subscriber(s) do its work *)
IF initMqtt THEN
	MQTTClient(
		MQTT_IN_OUT:= MQTT_IN_OUT, 
		ENABLE:= TRUE, 
		URL:= broker, 
		TIMEOUT:= T#1S, 
		TLS:= FALSE);

	subscriber_FB_OUTPUT_SWITCH_MQTT(
		Subscribe:= TRUE, 
		Topic:= ADR('WAGO-PFC200/In/DigitalOutputs/+'), 
		QoSSubscribe:= SD_MQTT.QoS.ExactlyOnce, 
		ExpectingString:= TRUE, 
		Callback:= MqttVariables.collector_FB_OUTPUT_SWITCH_MQTT,
	);
	
	subscriber_FB_OUTPUT_COVER_MQTT(
		Subscribe:= TRUE, 
		Topic:= ADR('WAGO-PFC200/In/Covers/+'), 
		QoSSubscribe:= SD_MQTT.QoS.ExactlyOnce, 
		ExpectingString:= TRUE, 
		Callback:= MqttVariables.collector_FB_OUTPUT_COVER_MQTT,
	);
	
	subscriber_FB_VIRTUAL_MQTT(
		Subscribe:= TRUE, 
		Topic:= ADR('WAGO-PFC200/In/Virtuals/+'), 
		QoSSubscribe:= SD_MQTT.QoS.ExactlyOnce, 
		ExpectingString:= TRUE, 
		Callback:= MqttVariables.collector_FB_VIRTUAL_MQTT,
	);
	subscriber_FB_DIMMER_MQTT(
		Subscribe:= TRUE, 
		Topic:= ADR('WAGO-PFC200/In/Dimmers/+'), 
		QoSSubscribe:= SD_MQTT.QoS.ExactlyOnce, 
		ExpectingString:= TRUE, 
		Callback:= MqttVariables.collector_FB_DIMMER_MQTT,
	);
END_IF
</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
              </actions>
              <body>
                <SFC>
                  <step localId="0" initialStep="true" name="Init">
                    <position x="0" y="0" />
                    <connectionPointIn />
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">Init</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">TRUE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="2">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" />
                    </connectionPointIn>
                    <action localId="1" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="MQTT_INIT" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MQTT_INIT</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="3">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>True</expression>
                  </inVariable>
                  <transition localId="4">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="3" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">True</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <step localId="5" name="MQTT">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="4" />
                    </connectionPointIn>
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MQTT</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">FALSE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="8">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" />
                    </connectionPointIn>
                    <action localId="6" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="MQTT_PUBLISH" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MQTT_PUBLISH</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                    <action localId="7" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="MQTT_SUBSCRIBE" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MQTT_SUBSCRIBE</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="9">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>TRUE</expression>
                  </inVariable>
                  <transition localId="10">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="9" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">TRUE</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <jumpStep localId="11" targetName="MQTT">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="10" />
                    </connectionPointIn>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">MQTT</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </jumpStep>
                </SFC>
              </body>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/sfcsettings" handleUnknown="implementation">
                  <SFCSettings>
                    <LibTitle>IecSfc</LibTitle>
                    <LibCompany>System</LibCompany>
                    <LibVersion>3.4.2.0</LibVersion>
                    <LibNamespace>IecSfc</LibNamespace>
                    <CalcActiveTransOnly>false</CalcActiveTransOnly>
                    <UseDefaults>false</UseDefaults>
                    <Flags>
                      <EnableLimit Declare="true" Use="false" />
                      <Init Declare="true" Use="false" />
                      <Reset Declare="true" Use="false" />
                      <QuitError Declare="true" Use="false" />
                      <Pause Declare="true" Use="false" />
                      <Error Declare="true" Use="false" />
                      <Trans Declare="true" Use="false" />
                      <ErrorStep Declare="true" Use="false" />
                      <ErrorPOU Declare="true" Use="false" />
                      <CurrentStep Declare="true" Use="false" />
                      <Tip Declare="true" Use="false" />
                      <TipMode Declare="true" Use="false" />
                      <MaxFlags Declare="true" Use="false" />
                      <SFCErrorAnalyzation Declare="true" Use="false" />
                      <SFCErrorAnalyzationTable Declare="true" Use="false" />
                    </Flags>
                  </SFCSettings>
                </data>
              </addData>
            </pou>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/pou" handleUnknown="implementation">
            <pou name="PLC_PRG_RS485" pouType="program">
              <interface>
                <localVars>
                  <variable name="ModbusMaster">
                    <type>
                      <derived name="WagoAppPlcModbus.FbMbMasterSerial" />
                    </type>
                    <initialValue>
                      <structValue>
                        <value member="xConnect">
                          <simpleValue value="TRUE" />
                        </value>
                        <value member="udiBaudrate">
                          <simpleValue value="9600" />
                        </value>
                        <value member="usiDataBits">
                          <simpleValue value="8" />
                        </value>
                        <value member="eParity">
                          <simpleValue value="WagoTypesCom.eTTYParity.None" />
                        </value>
                        <value member="eStopBits">
                          <simpleValue value="WagoTypesCom.eTTYStopBits.One" />
                        </value>
                        <value member="eHandshake">
                          <simpleValue value="WagoTypesCom.eTTYHandshake.None" />
                        </value>
                        <value member="ePhysical">
                          <simpleValue value="WagoTypesCom.eTTYPhysicalLayer.RS485_HalfDuplex" />
                        </value>
                        <value member="eFrameType">
                          <simpleValue value="eMbFrameType.RTU" />
                        </value>
                        <value member="tTimeOut">
                          <simpleValue value="TIME#500ms" />
                        </value>
                      </structValue>
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> CODESYS 3S Version version

	xComPortOpen         : BOOL;
    xComPortError        : BOOL;
    rtsResult            : RTS_IEC_RESULT;	
    stComPortSettings    : SysCom.SysComSettings :=(
											ulBaudrate :=9600,
											byParity := 0,
											byStopBits:=1,
											ulTimeout :=500,
											ulBufferSize :=256,
											
											sPort:=SYS_COM_PORTS.SYS_COMPORT1											
										);
    hComPort             : RTS_IEC_HANDLE; 
    awReadBuffer         : ARRAY[0..124] OF WORD;        
    awWriteBuffer        : ARRAY[0..124] OF WORD;     
    fbModbusRequest      : IoDrvModbus.ModbusRequest2;
    eComError            : IoDrvModbus.MB_ErrorCodes;	
	
 é!COCKPIT version</xhtml>
                    </documentation>
                  </variable>
                  <variable name="RtuQuery">
                    <type>
                      <derived name="WagoAppPlcModbus.typMbQuery" />
                    </type>
                  </variable>
                  <variable name="RtuResponse">
                    <type>
                      <derived name="WagoAppPlcModbus.typMbResponse" />
                    </type>
                  </variable>
                  <variable name="Trigger">
                    <type>
                      <BOOL />
                    </type>
                    <initialValue>
                      <simpleValue value="FALSE" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> Shared variables for é!COCKPIT and CODESYS 3S Version </xhtml>
                    </documentation>
                  </variable>
                  <variable name="ActiveRtuQuery">
                    <type>
                      <derived name="RS485_RtuQuery" />
                    </type>
                  </variable>
                  <variable name="RS485BusController">
                    <type>
                      <derived name="FB_RS485_BUSCONTROLLER" />
                    </type>
                  </variable>
                  <variable name="MqttRS485Prefix">
                    <type>
                      <string length="100" />
                    </type>
                    <initialValue>
                      <simpleValue value="'WAGO-PFC200/Out/RS485/'" />
                    </initialValue>
                    <documentation>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml"> RS485 </xhtml>
                    </documentation>
                  </variable>
                  <variable name="FB_RS485_EASTRON_SDM220_1">
                    <type>
                      <derived name="FB_RS485_EASTRON_SDM220_MQTT" />
                    </type>
                  </variable>
                </localVars>
              </interface>
              <actions>
                <action name="READ_DEVICES">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">(* CODESYS 3S Version version*)
(*
IF(NOT xComPortOpen AND NOT xComPortError) THEN
    hComPort := SysCom.SysComOpen2( pSettings := ADR(stComPortSettings), pSettingsEx := 0, pResult := ADR(rtsResult));     
    xComPortError := (hComPort = RTS_INVALID_HANDLE OR rtsResult &lt;&gt; 0);
    xComPortOpen := NOT xComPortError;
END_IF

IF(xComPortOpen) THEN
    IF FB_RS485_EASTRON_SDM220_1.RequestMaster(ADR(RS485BusController)) THEN
		IF FB_RS485_EASTRON_SDM220_1.ActiveRtuQuery = 0 THEN
			ActiveRtuQuery := FB_RS485_EASTRON_SDM220_1.GetRtuQuery();
			Trigger := TRUE; // Start the Modbus RTU query
		ELSIF fbModbusRequest.xDone OR fbModbusRequest.xError THEN // Modbus RTU query completed, process it
			FB_RS485_EASTRON_SDM220_1.ProcessDataArray(Error:=fbModbusRequest.xError, Data:=ADR(awReadBuffer));
			RS485BusController.ReleaseBus();
			TRIGGER := FALSE;
		END_IF	
	END_IF

END_IF

IF xComPortOpen AND RS485BusController.BusOcupied THEN
	fbModbusRequest.modbusCommand.uiFunctionCode := ActiveRtuQuery.FunctionCode;
    fbModbusRequest.modbusCommand.uiReadOffset := ActiveRtuQuery.ReadAddress;	
    fbModbusRequest.modbusCommand.uiReadLen :=ActiveRtuQuery.ReadQuantity;	   
    fbModbusRequest.pRecvData := ADR(awReadBuffer);
    fbModbusRequest.pSendData := ADR(awWriteBuffer);        
    fbModbusRequest.tResponseTimeout := T#1S;
	fbModbusRequest.transmission := MB_Transmission.RTU;
    fbModbusRequest(
        hComPort := hComPort,
        xExecute := Trigger,
        usiSlaveAddr := ActiveRtuQuery.DeviceId,		
        byModbusError =&gt; eComError);
		
END_IF	
*)
	
(* é!COCKPIT version*)
IF FB_RS485_EASTRON_SDM220_1.RequestMaster(ADR(RS485BusController)) THEN
	IF FB_RS485_EASTRON_SDM220_1.ActiveRtuQuery = 0 THEN
		ActiveRtuQuery := FB_RS485_EASTRON_SDM220_1.GetRtuQuery();
		Trigger := TRUE; // Start the Modbus RTU query
	ELSIF Trigger = FALSE THEN // Modbus RTU query completed, process it
		FB_RS485_EASTRON_SDM220_1.ProcessDataArray(Error:=ModbusMaster.xError, Data:=ADR(RtuResponse.awData));
		RS485BusController.ReleaseBus();
	END_IF	
END_IF




IF RS485BusController.BusOcupied THEN
	RtuQuery.bUnitId := ActiveRtuQuery.DeviceId;	
	RtuQuery.bFunctionCode := ActiveRtuQuery.FunctionCode;	
	RtuQuery.uiReadAddress := ActiveRtuQuery.ReadAddress;	
	RtuQuery.uiReadQuantity := ActiveRtuQuery.ReadQuantity;
	ModbusMaster(
		I_Port := IoConfig_Globals.COM1,
		utQuery:= RtuQuery,
		xTrigger := Trigger,
		utResponse:= RtuResponse);
END_IF


(* Shared variables for é!COCKPIT and CODESYS 3S Version *)
RS485BusController();</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="PROCESS_FB">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">FB_RS485_EASTRON_SDM220_1();</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
                <action name="RS485_INIT">
                  <body>
                    <ST>
                      <xhtml xmlns="http://www.w3.org/1999/xhtml">(* INIT RS485 BUS CONTROLLER *)
RS485BusController.Init(
	StartupDelay := T#5S,	(* Time to wait after startup to start using the bus, prevents boot delay issues when RS485 are not ready yet on startup *)		
	SilenceTime := T#20MS	(* Silence time between two requests, important to not get faulty data on bus *)		
);

(* INIT RS485 DEVICE STUFF *)
FB_RS485_EASTRON_SDM220_1.InitRS485(
	Data1PollingInterval := T#10S,		(* Polling interval for data array 1 *)				
	Data2PollingInterval := T#20S,		(* Polling interval for data array 2 *)			
	Data3PollingInterval := T#30S,		(* Polling interval for data array 3 *)			
	DeviceAddress := 1					(* Device address of the modbus device *)			
);

FB_RS485_EASTRON_SDM220_1.InitMqtt(
	MQTTPublishPrefix:= ADR(MqttRS485Prefix),						(* pointer to string prefix for the mqtt publish topic *)
	pMqttPublishQueue := ADR(MqttVariables.fbMqttPublishQueue)		(* pointer to MqttPublishQueue to send a new Mqtt event *)
);

</xhtml>
                    </ST>
                  </body>
                  <addData />
                </action>
              </actions>
              <body>
                <SFC>
                  <step localId="0" initialStep="true" name="Init">
                    <position x="0" y="0" />
                    <connectionPointIn />
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">Init</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">TRUE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="2">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" />
                    </connectionPointIn>
                    <action localId="1" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="RS485_INIT" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">RS485_INIT</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="3">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>TRUE</expression>
                  </inVariable>
                  <transition localId="4">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="0" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="3" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">TRUE</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <step localId="5" name="RS485">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="4" />
                    </connectionPointIn>
                    <connectionPointOut formalParameter="sfc" />
                    <connectionPointOutAction formalParameter="x" />
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">RS485</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="6844a48e-46c2-4cc8-a185-a478f3b99cc0">FALSE</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </step>
                  <actionBlock localId="8">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" />
                    </connectionPointIn>
                    <action localId="6" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="READ_DEVICES" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">READ_DEVICES</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                    <action localId="7" qualifier="N" duration="" indicator="">
                      <relPosition x="0" y="0" />
                      <reference name="PROCESS_FB" />
                      <connectionPointOut />
                      <addData>
                        <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                          <attributes xmlns="">
                            <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">PROCESS_FB</attribute>
                            <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                            <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                            <attribute guid="e174fc0d-80b0-4a9e-a530-ca239c249a50">N</attribute>
                          </attributes>
                        </data>
                      </addData>
                    </action>
                  </actionBlock>
                  <inVariable localId="9">
                    <position x="0" y="0" />
                    <connectionPointOut />
                    <expression>TRUE</expression>
                  </inVariable>
                  <transition localId="10">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="5" formalParameter="sfc" />
                    </connectionPointIn>
                    <condition>
                      <connectionPointIn>
                        <connection refLocalId="9" />
                      </connectionPointIn>
                    </condition>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">TRUE</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                          <attribute guid="bc882c11-1e91-4dd8-a6b8-2075724ed18b">0</attribute>
                          <attribute guid="62e1754b-7629-4e63-9cec-10ae0c536f1f">FALSE</attribute>
                          <attribute guid="8294df19-5962-4dee-a874-1051dabb0e3e">0</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </transition>
                  <jumpStep localId="11" targetName="RS485">
                    <position x="0" y="0" />
                    <connectionPointIn>
                      <connection refLocalId="10" />
                    </connectionPointIn>
                    <addData>
                      <data name="http://www.3s-software.com/plcopenxml/sfc/element" handleUnknown="implementation">
                        <attributes xmlns="">
                          <attribute guid="38391c6d-6d4a-42f8-8ee7-9f45e5adafa8">RS485</attribute>
                          <attribute guid="01580b27-6378-448b-8ecb-0e4b795b58d6">FALSE</attribute>
                        </attributes>
                      </data>
                    </addData>
                  </jumpStep>
                </SFC>
              </body>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/sfcsettings" handleUnknown="implementation">
                  <SFCSettings>
                    <LibTitle>IecSfc</LibTitle>
                    <LibCompany>System</LibCompany>
                    <LibVersion>3.4.2.0</LibVersion>
                    <LibNamespace>IecSfc</LibNamespace>
                    <CalcActiveTransOnly>false</CalcActiveTransOnly>
                    <UseDefaults>false</UseDefaults>
                    <Flags>
                      <EnableLimit Declare="true" Use="false" />
                      <Init Declare="true" Use="false" />
                      <Reset Declare="true" Use="false" />
                      <QuitError Declare="true" Use="false" />
                      <Pause Declare="true" Use="false" />
                      <Error Declare="true" Use="false" />
                      <Trans Declare="true" Use="false" />
                      <ErrorStep Declare="true" Use="false" />
                      <ErrorPOU Declare="true" Use="false" />
                      <CurrentStep Declare="true" Use="false" />
                      <Tip Declare="true" Use="false" />
                      <TipMode Declare="true" Use="false" />
                      <MaxFlags Declare="true" Use="false" />
                      <SFCErrorAnalyzation Declare="true" Use="false" />
                      <SFCErrorAnalyzationTable Declare="true" Use="false" />
                    </Flags>
                  </SFCSettings>
                </data>
              </addData>
            </pou>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/libraries" handleUnknown="implementation">
            <Libraries>
              <Library Name="#Standard" Namespace="Standard" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="Standard, * (System)" />
              <Library Name="#IecSfc" Namespace="IecSfc" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="IecSfc, 3.4.2.0 (System)" />
              <Library Name="#Analyzation" Namespace="Analyzation" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="Analyzation, 3.5.2.0 (System)">
                <Parameters>
                  <Parameter Name="TABLE_UPPER_BOUND" Value="15" />
                  <Parameter Name="STRING_LENGTH_EXP" Value="255" />
                  <Parameter Name="STRING_LENGTH_ADDRESS" Value="20" />
                  <Parameter Name="STRING_LENGTH_COMMENT" Value="255" />
                  <Parameter Name="STRING_LENGTH_OUTSTRING" Value="255" />
                  <Parameter Name="TABLE_SHOW_VALID_ITEMS" Value="FALSE" />
                </Parameters>
              </Library>
              <Library Name="BASIC, 3.3.3.0 (OSCAT)" Namespace="OSCAT_BASIC" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" />
              <Library Name="BUILDING, 1.0.0.0 (OSCAT)" Namespace="OSCAT_BUILDING" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" />
              <Library Name="OSCAT NETWORK, 1.30 (OSCAT)" Namespace="OSCAT_NETWORK" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" />
              <Library Name="#CDS_MemMan" Namespace="CMM" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="CDS_MemMan, 3.3.2.0 (3S - Smart Software Solutions GmbH)" />
              <Library Name="Element Collections, 3.5.14.0 (3S - Smart Software Solutions GmbH)" Namespace="COL" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" />
              <Library Name="#IoStandard" Namespace="IoStandard" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="true" DefaultResolution="IoStandard, 3.5.15.0 (System)" />
              <Library Name="#CAA Device Diagnosis" Namespace="DED" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="CAA Device Diagnosis, 3.5.15.0 (CAA Technical Workgroup)" />
              <Library Name="#WagoAppProcessorLoad" Namespace="WagoAppProcessorLoad" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="WagoAppProcessorLoad, * (WAGO)" />
              <Library Name="#WagoSysKbusTerminalControl" Namespace="WagoSysKbusTerminalControl" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="WagoSysKbusTerminalControl, 1.7.3.0 (WAGO)" />
              <Library Name="#WagoSysComInternal" Namespace="WagoSysCom_Internal" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="WagoSysCom_Internal_PFC, 1.0.2.2 (WAGO)">
                <Parameters>
                  <Parameter Name="CUDIMAXCOMNUMBER" Value="32767" />
                </Parameters>
              </Library>
              <Library Name="#BreakpointLogging" Namespace="BPLog" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="Breakpoint Logging Functions, 3.5.5.0 (3S - Smart Software Solutions GmbH)" />
              <Library Name="#CommonTypsFunctions" Namespace="CommonTypesAndFunctions" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="Common Helper for development, * (Stefan Dreyer)" />
              <Library Name="#3SLicense" Namespace="_3S_LICENSE" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="3SLicense, 0.0.0.0 (3S - Smart Software Solutions GmbH)" ResolverGuid="97c3b452-d9fa-4ac2-9d0c-3d420aa6d95b" />
              <Library Name="#WagoSysStandard" Namespace="WagoSysStandard" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="WagoSysStandard, * (WAGO)" />
              <Library Name="#WagoTypesAppLED" Namespace="WagoTypesAppLED" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="WagoTypesAppLED, * (WAGO)" />
              <Library Name="#WagoAppAppLED" Namespace="WagoAppAppLED" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="WagoAppAppLED, * (WAGO)" />
              <Library Name="#SD_MQTT" Namespace="SD_MQTT" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="MQTT, * (Stefan Dreyer)" />
              <Library Name="#WagoSysModbusDiag" Namespace="WagoSysModbusDiag" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="true" LinkAllContent="false" DefaultResolution="WagoSysModbus_Diag_PFC, 0.0.0.5 (WAGO)" />
              <Library Name="#WagoAppPlcModbus" Namespace="WagoAppPlcModbus" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="WagoAppPlcModbus, * (WAGO)">
                <Parameters>
                  <Parameter Name="MAX_SERVER_BUFFERSIZE" Value="4096" />
                </Parameters>
              </Library>
              <addData />
            </Libraries>
          </data>
        </addData>
      </resource>
    </data>
  </addData>
</project>